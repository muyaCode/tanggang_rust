<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>19 ｜ Rust 的宏体系：为自己的项目写一个简单的声明宏 | 唐刚-Rust语言从入门到实战</title>
    <meta name="description" content="Rust语言从入门到实战">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/tanggang_rust/assets/style.Dmb1gw5t.css" as="style">
    <link rel="preload stylesheet" href="/tanggang_rust/vp-icons.css" as="style">
    
    <script type="module" src="/tanggang_rust/assets/app.DakBAcEX.js"></script>
    <link rel="preload" href="/tanggang_rust/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/tanggang_rust/assets/chunks/theme.BYwnybAk.js">
    <link rel="modulepreload" href="/tanggang_rust/assets/chunks/framework.D2WelYEY.js">
    <link rel="modulepreload" href="/tanggang_rust/assets/Document_19｜Rust的宏体系：为自己的项目写一个简单的声明宏.md.DXluFKAD.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/tanggang_rust/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/tanggang_rust/img/buding.svg" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>Rust语言从入门到实战</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/00%EF%BD%9C%E5%BC%80%E7%AF%87%E8%AF%8D%EF%BD%9C%E6%8B%A5%E6%8A%B1Rust%E6%B5%AA%E6%BD%AE%EF%BC%8C%E8%BF%8E%E6%8E%A5%E6%9B%B4%E6%9E%81%E8%87%B4%E7%9A%84%E7%BC%96%E7%A8%8B%E4%BD%93%E9%AA%8C" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>00｜开篇词｜拥抱Rust浪潮，迎接更极致的编程体验</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/01%EF%BD%9C%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%EF%BC%9ARust%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BD%A0%E4%B8%8D%E5%BE%97%E4%B8%8D%E4%BA%86%E8%A7%A3%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>01｜快速入门：Rust中有哪些你不得不了解的基础语法？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/02%EF%BD%9C%E6%89%80%E6%9C%89%E6%9D%83%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9ARust%E6%98%AF%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E8%B5%84%E6%BA%90%E7%9A%84%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>02｜所有权（上）：Rust是如何管理程序中的资源的？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/03%EF%BD%9C%E6%89%80%E6%9C%89%E6%9D%83%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9ARust%E4%B8%AD%E5%80%9F%E7%94%A8%E4%B8%8E%E5%BC%95%E7%94%A8%E7%9A%84%E8%A7%84%E5%88%99%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>03｜所有权（下）：Rust中借用与引用的规则是怎样的？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/04%EF%BD%9C%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9A%E5%AF%B9%E5%8F%B7%E5%85%A5%E5%BA%A7%EF%BC%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%85%B6%E5%AE%9E%E6%B2%A1%E9%82%A3%E4%B9%88%E5%8F%AF%E6%80%95%EF%BC%81" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>04｜字符串：对号入座，字符串其实没那么可怕！</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/05%EF%BD%9C%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%89%B9%E6%80%A7" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>05｜复合类型（上）：结构体与面向对象特性</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/06%EF%BD%9C%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E6%9E%9A%E4%B8%BE%E4%B8%8E%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>06｜复合类型（下）：枚举与模式匹配</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/07%EF%BD%9C%E7%B1%BB%E5%9E%8B%E4%B8%8E%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0%EF%BC%9A%E7%BB%99Rust%E5%B0%8F%E5%8A%A9%E6%89%8B%E6%8F%90%E4%BE%9B%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>07｜类型与类型参数：给Rust小助手提供更多信息</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/08%EF%BD%9COption-T-%E4%B8%8EResult-T,E-%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>08｜Option-T-与Result-T,E-、迭代器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/09%EF%BD%9C%E5%88%9D%E8%AF%86trait%EF%BC%9A%E5%8D%8F%E8%AE%AE%E7%BA%A6%E6%9D%9F%E4%B8%8E%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>09｜初识trait：协议约束与能力配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/10%EF%BD%9C%E5%86%8D%E6%8E%A2trait%EF%BC%9A%E5%B8%A6%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0%E7%9A%84trait%E5%8F%8Atraitobject" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>10｜再探trait：带类型参数的trait及traitobject</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/11%EF%BD%9C%E5%B8%B8%E8%A7%81trait%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%A0%87%E5%87%86%E5%BA%93%E4%B8%AD%E7%9A%84%E5%B8%B8%E8%A7%81trait%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E7%94%A8%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>11｜常见trait解析：标准库中的常见trait应该怎么用？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%EF%BC%88%E4%B8%80%EF%BC%89%EF%BD%9C%E7%AC%AC%E4%B8%80%E7%AB%A0Rust%E5%9F%BA%E7%A1%80%E7%AF%87%E6%80%9D%E8%80%83%E9%A2%98%E7%AD%94%E6%A1%88" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>答疑课堂（一）｜第一章Rust基础篇思考题答案</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/12%EF%BD%9C%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%EF%BC%9A%E4%BB%8E%E6%89%80%E6%9C%89%E6%9D%83%E7%9C%8B%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>12｜智能指针：从所有权看智能指针</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/13%EF%BD%9C%E7%8B%AC%E7%AB%8B%E7%8E%8B%E5%9B%BD%EF%BC%9A%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3Rust%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>13｜独立王国：初步了解Rust异步并发编程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/14%EF%BD%9Ctokio%E5%AE%9E%E6%88%98%EF%BC%9A%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%A8%8B%E5%BA%8F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>14｜tokio实战：编写一个网络命令行程序</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/15%EF%BD%9Ctokio%E7%BC%96%E7%A8%8B%EF%BC%9A%E5%9C%A8%E5%A4%9A%E4%BB%BB%E5%8A%A1%E4%B9%8B%E9%97%B4%E6%93%8D%E4%BD%9C%E5%90%8C%E4%B8%80%E7%89%87%E6%95%B0%E6%8D%AE" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>15｜tokio编程：在多任务之间操作同一片数据</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/16%EF%BD%9Ctokio%E7%BC%96%E7%A8%8B%EF%BC%9A%E4%BD%BF%E7%94%A8channel%E5%9C%A8%E4%B8%8D%E5%90%8C%E4%BB%BB%E5%8A%A1%E9%97%B4%E9%80%9A%E4%BF%A1%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>16｜tokio编程：使用channel在不同任务间通信？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/17%EF%BD%9Ctokio%E7%BC%96%E7%A8%8B%EF%BC%9ARust%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E8%BF%98%E6%9C%89%E5%93%AA%E4%BA%9B%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%82%B9%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>17｜tokio编程：Rust异步编程还有哪些需要注意的点？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/18%EF%BD%9C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%9A%E9%94%99%E8%AF%AF%E7%9A%84%E6%9E%84%E5%BB%BA%E3%80%81%E4%BC%A0%E9%80%92%E5%92%8C%E5%A4%84%E7%90%86" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>18｜错误处理系统：错误的构建、传递和处理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/19%EF%BD%9CRust%E7%9A%84%E5%AE%8F%E4%BD%93%E7%B3%BB%EF%BC%9A%E4%B8%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A3%B0%E6%98%8E%E5%AE%8F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>19｜Rust的宏体系：为自己的项目写一个简单的声明宏</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/20%EF%BD%9C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%9ARust%E5%A6%82%E4%BD%95%E5%81%9A%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AC%A6%E5%8F%B7%E6%A0%87%E6%B3%A8%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>20｜生命周期：Rust如何做基本的生命周期符号标注？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BD%9C%E7%AC%AC%E4%BA%8C%E7%AB%A0Rust%E8%BF%9B%E9%98%B6%E7%AF%87%E6%80%9D%E8%80%83%E9%A2%98%E7%AD%94%E6%A1%88" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>答疑课堂（二）｜第二章Rust进阶篇思考题答案</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/21%EF%BD%9CWeb%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Axum%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8CWeb%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>21｜Web开发（上）：如何使用Axum框架进行Web后端开发？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/22%EF%BD%9CWeb%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AATodoList%E5%BA%94%E7%94%A8%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>22｜Web开发（下）：如何实现一个TodoList应用？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/23%EF%BD%9CRust%E4%B8%8E%E5%A4%A7%E6%A8%A1%E5%9E%8B%EF%BC%9A%E7%94%A8Candle%E5%81%9A%E4%B8%80%E4%B8%AA%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>23｜Rust与大模型：用Candle做一个聊天机器人</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/24%EF%BD%9CRust%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%EF%BC%9A%E5%88%A9%E7%94%A8YOLOv8%E8%AF%86%E5%88%AB%E5%AF%B9%E8%B1%A1" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>24｜Rust图像识别：利用YOLOv8识别对象</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/25%EF%BD%9CRustGUI%E7%BC%96%E7%A8%8B%EF%BC%9A%E7%94%A8Slint%E4%B8%BAChatbot%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%95%8C%E9%9D%A2" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>25｜RustGUI编程：用Slint为Chatbot实现一个界面</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/26%EF%BD%9CRustGUI%E7%BC%96%E7%A8%8B%EF%BC%9A%E7%94%A8Slint%E4%B8%BAYOLOv8%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%95%8C%E9%9D%A2" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>26｜RustGUI编程：用Slint为YOLOv8实现一个界面</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/27%EF%BD%9CRustBevy%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%EF%BC%9A%E7%94%A8300%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%81%9A%E4%B8%80%E4%B8%AA%E8%B4%AA%E5%90%83%E8%9B%87%E6%B8%B8%E6%88%8F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>27｜RustBevy游戏开发：用300行代码做一个贪吃蛇游戏</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/28%EF%BD%9CNom%EF%BC%9A%E7%94%A8Rust%E5%86%99%E4%B8%80%E4%B8%AAParser%E8%A7%A3%E6%9E%90%E5%99%A8" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>28｜Nom：用Rust写一个Parser解析器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/29%EF%BD%9CUnsafe%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9AUnsafeRust%E4%B8%AD%E9%82%A3%E4%BA%9B%E8%A2%AB%E5%B0%81%E5%8D%B0%E7%9A%84%E8%83%BD%E5%8A%9B" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>29｜Unsafe编程（上）：UnsafeRust中那些被封印的能力</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/30%EF%BD%9CUnsafe%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8Rust%E4%B8%BAPython%E5%86%99%E4%B8%80%E4%B8%AA%E6%89%A9%E5%B1%95" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>30｜Unsafe编程（下）：使用Rust为Python写一个扩展</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%EF%BC%88%E4%B8%89%EF%BC%89%EF%BD%9C%E7%AC%AC%E4%B8%89%E7%AB%A0Rust%E5%BA%94%E7%94%A8%E7%AF%87%E6%80%9D%E8%80%83%E9%A2%98%E7%AD%94%E6%A1%88" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>答疑课堂（三）｜第三章Rust应用篇思考题答案</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%BB%93%E8%AF%BE%E6%B5%8B%E8%AF%95%EF%BD%9C%E6%9D%A5%E8%B5%B4%E4%B8%80%E5%9C%BA%E6%BB%A1%E5%88%86%E4%B9%8B%E7%BA%A6" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>结课测试｜来赴一场满分之约</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%BB%93%E6%9D%9F%E8%AF%AD%EF%BD%9C%E6%9C%AA%E6%9D%A5%E8%AE%A9Rust%E5%B8%A6%E4%BD%A0%E2%80%9C%E9%94%88%E2%80%9D%E5%88%B0%E8%B5%B7%E9%A3%9E" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>结束语｜未来让Rust带你“锈”到起飞</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>⚡️文档内容大纲</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _tanggang_rust_Document_19%EF%BD%9CRust%E7%9A%84%E5%AE%8F%E4%BD%93%E7%B3%BB%EF%BC%9A%E4%B8%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A3%B0%E6%98%8E%E5%AE%8F" data-v-39a288b8><div><h1 id="_19-rust-的宏体系-为自己的项目写一个简单的声明宏" tabindex="-1">19 ｜ Rust 的宏体系：为自己的项目写一个简单的声明宏 <a class="header-anchor" href="#_19-rust-的宏体系-为自己的项目写一个简单的声明宏" aria-label="Permalink to &quot;19 ｜ Rust 的宏体系：为自己的项目写一个简单的声明宏&quot;">​</a></h1><p>你好，我是 Mike，今天我们一起来学习 Rust 语言中有关宏的知识。</p><p>宏是一套预处理设施。它的输入是代码本身，对代码进行变换然后输出新的代码。一般来说，输出的新代码必须是合法的当前语言的代码，用来喂给当前语言的编译器进行编译。</p><p>宏不是一门语言的必备选项，Java、Go 等语言就没有宏，而 C、CPP、Rust 等语言有宏，而且它们的宏工作方式不一样。</p><p>在 Rust 语言中，宏也属于语言的外围功能，用来增强 Rust 语言的核心功能，让 Rust 语言变得更方便好用。宏不属于 Rust 语言的核心，但这并不是说宏在 Rust 中不重要。其实在 Rust 代码中，宏随处可见，掌握宏的原理和用法，有助于我们编写更高效的 Rust 代码。</p><p>在 Rust 中，宏的解析和执行是在 Rust 代码的编译阶段之前。你可以理解成，在 Rust 代码编译之前有一个宏展开的过程，这个过程的输出结果就是完整版的 Rust 代码，然后 Rust 编译器再来编译这个输出的代码。</p><h2 id="rust-语言中的宏" tabindex="-1">Rust 语言中的宏 <a class="header-anchor" href="#rust-语言中的宏" aria-label="Permalink to &quot;Rust 语言中的宏&quot;">​</a></h2><p>当前版本的 Rust 中有两大类宏：声明宏（declarative macro）和过程宏（procedure macro），而过程宏又细分成三种：派生宏、属性宏和函数宏。</p><p>下面我们分别介绍一下它们。</p><h3 id="声明宏" tabindex="-1">声明宏 <a class="header-anchor" href="#声明宏" aria-label="Permalink to &quot;声明宏&quot;">​</a></h3><p>声明宏是用 <code>macro_rules!</code> 定义的宏，我们常见的 <code>println!()</code>、 <code>vec![]</code> 都是这种宏。比如 <code>vec![]</code> 是按类似下面这种方式定义的：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#[macro_export]</span></span>
<span class="line"><span style="color:#61AFEF;">macro_rules!</span><span style="color:#61AFEF;"> vec</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    ( $( $</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;">expr</span><span style="color:#ABB2BF;"> ),* ) =&gt; {</span></span>
<span class="line"><span style="color:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#C678DD;">            let</span><span style="color:#C678DD;"> mut</span><span style="color:#E06C75;"> temp_vec</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Vec</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">            $(</span></span>
<span class="line"><span style="color:#E06C75;">                temp_vec</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">($</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            )*</span></span>
<span class="line"><span style="color:#E06C75;">            temp_vec</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    };</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>注：代码来自官方 The Book，这是一个演示版的定义，实际的 <code>vec!</code> 的定义比这个要复杂得多。</p><p>这是什么代码？完全看不懂，不是正常的 Rust 代码吧？是的，为了对 Rust 代码本身进行操作，需要重新定义一套语法形式，而这种语法形式，只在 <code>macro_rules!</code> 里有效。</p><p>宏整体上来说，使用了一种 <strong>代码匹配 + 生成机制</strong> 来生成新的代码。上面代码里的 <code>$()</code> 用来匹配代码条目。 <code>$x:expr</code> 表示匹配的是一个表达式，匹配后的条目用 <code>$x</code> 代替。 <code>*</code> 表示前面这个模式可以重复 0 次或者 1 次以上，这个模式就是 <code>$( $x:expr ),</code>，注意 <code>$()</code> 后面有个 <code>，</code> 号，这个逗号也是这个模式中的一部分，在匹配的时候是一个可选项，有就匹配，遇到最后一个匹配项的时候，就忽略它。 <code>=&gt;</code> 前面是起匹配作用的部分， <code>=&gt;</code> 后面是生成代码的部分。</p><p>在生成代码的部分中， <code>$()</code> 号和 <code>=&gt;</code> 前面那个 <code>$()</code> 的作用差不多，就是表明被包起来的这块代码是可重复的。紧跟的 <code>*</code> 表示这个代码块可以重复 0 次到多次。具体次数等于 <code>=&gt;</code> 号前面的 <code>*</code> 号所代表的次数，两个一致。下面我们创建一个拥有三个整数元素的 Vec。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> v</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> vec!</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">];</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>代码展开后实际就是：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#C678DD;"> mut</span><span style="color:#E06C75;"> temp_vec</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Vec</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;">    temp_vec</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    temp_vec</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    temp_vec</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    temp_vec</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>你可以看到， <code>temp_vec.push();</code> 重复了 3 次，这是因为 <code>1,2,3</code> 匹配 <code>$x: expr</code>，匹配了 3 次，分别匹配出 1、2、3 三个整数。然后就生成了三行 <code>temp_vec.push();</code>。</p><p>你可能会问， <code>vec![]</code> 这对中括号哪里去了？其实在 Rust 中，你用 ()、[]、{} 都可以，比如：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> a</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> vec!</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> b</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> vec!</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> c</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> vec!</span><span style="color:#ABB2BF;"> { </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;"> };</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>不过也确实存在一些习惯性的表述，比如对于 Vec 这种列表，用 [] 显得更地道，其他语言也多用 []，这样能够和程序员的习惯保持一致。对于类函数式的调用，使用 () 更地道。对于构建结构体之类的宏或者存在大段代码输入的情况，用 {} 更合适。</p><p>现在你是不是能读懂一点了？</p><p>上面代码里的 expr 表示要匹配的 item 是个表达式。常见的匹配方式有 7 种。</p><ul><li>expr：匹配表达式</li><li>ty：匹配类型</li><li>stmt：匹配语句</li><li>item：匹配一个 item</li><li>ident：匹配一个标识符</li><li>path：匹配一个 path</li><li>tt：匹配一个 token tree</li></ul><p>完整的说明，你可以看我给出的参考 <a href="https://doc.rust-lang.org/stable/reference/macros-by-example.html" target="_blank" rel="noreferrer">链接</a>。</p><p>常见的重复符号有 3 个。</p><ul><li><code>*</code> 表示重复 0 到多次。</li><li><code>+</code> 表示重复 1 到多次。</li><li><code>?</code> 表示重复 0 次或 1 次。</li></ul><p>利用刚刚学到的知识，我们可以自己动手写一个声明宏。</p><h3 id="自己动手写一个声明宏" tabindex="-1">自己动手写一个声明宏 <a class="header-anchor" href="#自己动手写一个声明宏" aria-label="Permalink to &quot;自己动手写一个声明宏&quot;">​</a></h3><p><strong>目标：</strong> 实现一个加法宏 <code>add!(1,2)</code>，输出结果 3。</p><p>你可以看一下示例代码。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">macro_rules!</span><span style="color:#61AFEF;"> add</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // 第一个分支，匹配两个元素的加法</span></span>
<span class="line"><span style="color:#ABB2BF;">    ($</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;">expr</span><span style="color:#ABB2BF;">, $</span><span style="color:#E06C75;">b</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;">expr</span><span style="color:#ABB2BF;">)=&gt;{</span></span>
<span class="line"><span style="color:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#ABB2BF;">            $</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">+$</span><span style="color:#E06C75;">b</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    };</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // 第二个分支：当只有一个元素时，也应该处理，这是边界情况</span></span>
<span class="line"><span style="color:#ABB2BF;">    ($</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;">expr</span><span style="color:#ABB2BF;">)=&gt;{</span></span>
<span class="line"><span style="color:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#ABB2BF;">            $</span><span style="color:#E06C75;">a</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(){</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> sum</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> add!</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">);  </span><span style="color:#7F848E;font-style:italic;">// 调用宏</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> sum</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> add!</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>通过示例我们可以看到，声明宏里面可以写多个匹配分支，Rust 会根据匹配到的模式自动选择适配的分支进行套用。</p><p>我们可以用 <code>cargo expand</code> 来展开这个代码。</p><p><img src="/tanggang_rust/assets/4bc66a9c6a378c89cd119e0acc189ee8.BcmmSUGd.png" alt=""></p><p>展开后实际是下面这个样子。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#![feature(prelude_import)]</span></span>
<span class="line"><span style="color:#ABB2BF;">#[prelude_import]</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> std</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">prelude</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">rust_2021</span><span style="color:#ABB2BF;">::*;</span></span>
<span class="line"><span style="color:#ABB2BF;">#[macro_use]</span></span>
<span class="line"><span style="color:#C678DD;">extern</span><span style="color:#C678DD;"> crate</span><span style="color:#ABB2BF;"> std;</span></span>
<span class="line"><span style="color:#61AFEF;">macro_rules!</span><span style="color:#61AFEF;"> add</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    ($</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> : </span><span style="color:#E06C75;">expr</span><span style="color:#ABB2BF;">, $</span><span style="color:#E06C75;">b</span><span style="color:#ABB2BF;"> : </span><span style="color:#E06C75;">expr</span><span style="color:#ABB2BF;">) =&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#ABB2BF;">            $</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> + $</span><span style="color:#E06C75;">b</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            // 第一个分支，匹配两个元素的加法</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    } ; ($</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> : </span><span style="color:#E06C75;">expr</span><span style="color:#ABB2BF;">) =&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#ABB2BF;">            $</span><span style="color:#E06C75;">a</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            // 第二个分支：当只有一个元素时，也应该处理，这是边界情况</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> x</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> sum</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> { </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;"> + </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;"> }; </span><span style="color:#7F848E;font-style:italic;">// 调用宏</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> sum</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;"> };</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>请你仔细对比展开前后的代码，好好理解一下。不过，仅仅是两个元素的相加，写个宏好像多此一举了。下面我们把它扩展到多个数字的加法。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">macro_rules!</span><span style="color:#61AFEF;"> add</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    ( $($</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;">expr</span><span style="color:#ABB2BF;">),* ) =&gt; {</span></span>
<span class="line"><span style="color:#ABB2BF;">       {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">         // 开头要有个0，处理没有任何参数传入的情况</span></span>
<span class="line"><span style="color:#D19A66;">         0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">         // 重复的块</span></span>
<span class="line"><span style="color:#ABB2BF;">         $( + $</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> )*</span></span>
<span class="line"><span style="color:#ABB2BF;">       }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(){</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> sum</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> add!</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> sum</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> add!</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>你可以看一下它展开后的样子。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#![feature(prelude_import)]</span></span>
<span class="line"><span style="color:#ABB2BF;">#[prelude_import]</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> std</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">prelude</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">rust_2021</span><span style="color:#ABB2BF;">::*;</span></span>
<span class="line"><span style="color:#ABB2BF;">#[macro_use]</span></span>
<span class="line"><span style="color:#C678DD;">extern</span><span style="color:#C678DD;"> crate</span><span style="color:#ABB2BF;"> std;</span></span>
<span class="line"><span style="color:#61AFEF;">macro_rules!</span><span style="color:#61AFEF;"> add</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    ($($</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> : </span><span style="color:#E06C75;">expr</span><span style="color:#ABB2BF;">), *) =&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#D19A66;">            0</span><span style="color:#ABB2BF;"> $(+ $</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">) *</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            // 开头要有个0，处理没有任何参数传入的情况</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            // 重复的块</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">() { </span><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> sum</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> { </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;"> }; </span><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> sum</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> { </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;"> + </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;"> + </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;"> + </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;"> + </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;"> }; }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>可以看到，经过简单的改造，我们的 <code>add!()</code> 宏现在能处理无限多的相加项了。如果有时间，你可以进一步考虑如何处理总和溢出的问题。</p><p>我们可以先从这种简单的宏入手，边写边展开看效果，实现一个声明宏并不难。</p><h3 id="macro-export" tabindex="-1">macro_export <a class="header-anchor" href="#macro-export" aria-label="Permalink to &quot;macro_export&quot;">​</a></h3><p>在一个模块中写好声明宏后，想要提供给其他模块使用的话，你得使用 <code>#[macro_export]</code> 导出，比如：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">mod</span><span style="color:#ABB2BF;"> inner {</span></span>
<span class="line"><span style="color:#E5C07B;font-style:italic;">    super</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">m!</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">    crate</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">m!</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;">mod</span><span style="color:#ABB2BF;"> toexport {</span></span>
<span class="line"><span style="color:#ABB2BF;">    #[macro_export]    </span><span style="color:#7F848E;font-style:italic;">// 请注意这一句，把m!()导出到当前crate root下了</span></span>
<span class="line"><span style="color:#61AFEF;">    macro_rules!</span><span style="color:#61AFEF;"> m</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">        () =&gt; {};</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> foo</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E5C07B;">    self</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">m!</span><span style="color:#ABB2BF;">();  </span><span style="color:#7F848E;font-style:italic;">// main函数在当前crate根下，可这样调用m!()</span></span>
<span class="line"><span style="color:#61AFEF;">    m!</span><span style="color:#ABB2BF;">();        </span><span style="color:#7F848E;font-style:italic;">// 直接调用也是可以的</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>#[macro_export]</code> 可以把你定义的宏导出到当前 crate 根下，这样在 crate 里可以用 <code>crate::macro_name!</code> 访问（例子里的第 3 行 <code>crate::m!()</code>），在其他 crate 中可以使用 <code>use crate_name::macro_name</code> 导入。比如，我们假设上面代码里 crate 的名字是 mycrate，在另一个程序里可以这样导入这个宏。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> mycrate</span><span style="color:#ABB2BF;">::m;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> bar</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#61AFEF;">    m!</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="macro-use" tabindex="-1">macro_use <a class="header-anchor" href="#macro-use" aria-label="Permalink to &quot;macro_use&quot;">​</a></h3><p>前面我们使用了 <code>use mycrate::m</code> 这种精确的路径来导入 mycrate 中的 <code>m!()</code> 宏。如果一个 crate 里的宏比较多，我们想一次性全部导入，可以使用 <code>#[macro_use]</code> 属性，一次导入一个 crate 中所有已导出的宏，像下面这种写法：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#[macro_use] </span><span style="color:#C678DD;">extern</span><span style="color:#C678DD;"> crate</span><span style="color:#ABB2BF;"> rocket;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>不过这种写法算是 Rust 早期的遗留写法了，更推荐的还是用到哪个宏就引入哪个宏。有些代码库中还会有这种写法出现，你看到了需要知道是什么意思。</p><h3 id="认识过程宏之派生宏" tabindex="-1">认识过程宏之派生宏 <a class="header-anchor" href="#认识过程宏之派生宏" aria-label="Permalink to &quot;认识过程宏之派生宏&quot;">​</a></h3><p>常见的结构体上的 derive 标注，就是派生宏。比如我们 <a href="https://time.geekbang.org/column/article/729009?utm_campaign=geektime_search&amp;utm_content=geektime_search&amp;utm_medium=geektime_search&amp;utm_source=geektime_search&amp;utm_term=geektime_search" target="_blank" rel="noreferrer">上一节课</a> 讲到的 thiserror 提供的 Error 派生宏。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> thiserror</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Error</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#[derive(</span><span style="color:#E5C07B;">Error</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Debug</span><span style="color:#ABB2BF;">)]  </span><span style="color:#7F848E;font-style:italic;">// 派生宏</span></span>
<span class="line"><span style="color:#C678DD;">pub</span><span style="color:#C678DD;"> enum</span><span style="color:#E5C07B;"> DataStoreError</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    #[error(</span><span style="color:#98C379;">&quot;data store disconnected&quot;</span><span style="color:#ABB2BF;">)]  </span><span style="color:#7F848E;font-style:italic;">// 属性宏</span></span>
<span class="line"><span style="color:#61AFEF;">    Disconnect</span><span style="color:#ABB2BF;">(#[from] </span><span style="color:#E5C07B;">io</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Error</span><span style="color:#ABB2BF;">),       </span><span style="color:#7F848E;font-style:italic;">// 属性宏</span></span>
<span class="line"><span style="color:#ABB2BF;">    #[error(</span><span style="color:#98C379;">&quot;the data for key `{0}` is not available&quot;</span><span style="color:#ABB2BF;">)]  </span><span style="color:#7F848E;font-style:italic;">// 属性宏</span></span>
<span class="line"><span style="color:#61AFEF;">    Redaction</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    #[error(</span><span style="color:#98C379;">&quot;invalid header (expected {expected:?}, found {found:?})&quot;</span><span style="color:#ABB2BF;">)]  </span><span style="color:#7F848E;font-style:italic;">// 属性宏</span></span>
<span class="line"><span style="color:#E5C07B;">    InvalidHeader</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">        expected</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        found</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;">    #[error(</span><span style="color:#98C379;">&quot;unknown data store error&quot;</span><span style="color:#ABB2BF;">)]   </span><span style="color:#7F848E;font-style:italic;">// 属性宏</span></span>
<span class="line"><span style="color:#E5C07B;">    Unknown</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>上面示例中的 Debug 和 Error 就是派生宏。Debug 宏由 std 提供，Error 由 thiserror crate 提供。使用的时候，我们先使用 use 将宏导入到当前 crate 的 scope。然后在 <code>#[derive()]</code> 中使用它。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#[derive(</span><span style="color:#E5C07B;">Error</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Debug</span><span style="color:#ABB2BF;">)]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>它会作用在下面紧跟着的 enum DataStoreError 这个类型上面，对这个类型进行某种代码变换操作。最后的实现效果就是帮助我们实现了 <code>std::error::Error</code> 这个 trait，以及对应的 Debug、Display 等 trait。在我们看来，写上这一句话，就好像 Rust 自动帮我们完成了那些实现，给我们省了很多力气。</p><p>想看它到底在 enum DataStoreError 类型上施加了哪些魔法，只需要运行 <code>cargo expand</code> 展开它就可以了。你可以自己动手做一下实验。</p><p>在这个 enum DataStoreError 里的变体上，我们还可以看到另外两个宏 <code>#[error()]</code> 和 <code>#[from]</code>，它们不是派生宏，而是过程宏中的属性宏。</p><h3 id="认识过程宏之属性宏" tabindex="-1">认识过程宏之属性宏 <a class="header-anchor" href="#认识过程宏之属性宏" aria-label="Permalink to &quot;认识过程宏之属性宏&quot;">​</a></h3><p>Rust 编译器提供了一些属性（Attributes），属性是施加在模块、crate 或 item 上的元数据。这些元数据可用于很多地方。</p><ul><li>代码条件编译；</li><li>设置 crate 名字，版本号和类型（是二进制程序还是库）；</li><li>禁止代码提示；</li><li>开启编译器特性（宏、全局导入等）；</li><li>链接到外部库；</li><li>标记函数为单元测试；</li><li>标记函数为性能评测的一部分；</li><li>属性宏；</li><li>……</li></ul><p>要把属性施加到整个 crate，语法是在 crate 入口，比如在 lib.rs 或 main.rs 的第一行写上 <code>#![crate_attribute]</code>。</p><p>如果只想把属性施加到某个模块或者 item 上，就把 <code>!</code> 去掉。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#[item_attribute]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>属性上面还可以携带参数，可以写成下面几种形式：</p><ul><li><code>#[attribute = &quot;value&quot;]</code></li><li><code>#[attribute(key = &quot;value&quot;)]</code></li><li><code>#[attribute(value)]</code></li></ul><p>我们来看一下具体的例子。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 声明这个 crate 为 lib，是全局性的属性</span></span>
<span class="line"><span style="color:#ABB2BF;">#![crate_type </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;lib&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 声明下面这个函数为单元测试函数，这个属性只作用在test_foo()函数上</span></span>
<span class="line"><span style="color:#ABB2BF;">#[test]</span></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> test_foo</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    /* ... */</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 条件编译属性，这块深入下去细节非常多</span></span>
<span class="line"><span style="color:#ABB2BF;">#[cfg(target_os </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;linux&quot;</span><span style="color:#ABB2BF;">)]</span></span>
<span class="line"><span style="color:#C678DD;">mod</span><span style="color:#ABB2BF;"> bar {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    /* ... */</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 正常来说，Rust中的类型名需要是Int8T这种写法，下面这个示例让编译器不要发警告</span></span>
<span class="line"><span style="color:#ABB2BF;">#[allow(non_camel_case_types)]</span></span>
<span class="line"><span style="color:#C678DD;">type</span><span style="color:#E06C75;"> int8_t</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> i8</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 作用在整个函数内部，对未使用的变量不要报警</span></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> some_unused_variables</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#ABB2BF;">  #![allow(unused_variables)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  let</span><span style="color:#E06C75;"> x</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> ();</span></span>
<span class="line"><span style="color:#C678DD;">  let</span><span style="color:#E06C75;"> y</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> ();</span></span>
<span class="line"><span style="color:#C678DD;">  let</span><span style="color:#E06C75;"> z</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> ();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>如果你开始写原型代码的时候，经常出现变量或函数未使用的情况，Rust 编译器会提示一堆，有时看着心烦，你可以在 crate 入口文件头写上两行内容。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#![allow(unused_variables)]</span></span>
<span class="line"><span style="color:#ABB2BF;">#![allow(dead_code)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> foo</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> a</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 10</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> b</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 20</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>它会压制 Rust 编译器，让 Rust 编译器“放放水”。你可以试着把前面两行注释掉，看看 Rust 编译器会提示什么。但是对于一个严肃的项目来说，应该尽可能地消除这些“未使用”的警告，所以项目写到一定程度，就要把这种全局属性去掉。</p><p>Rust 中有非常丰富的属性，它们给 Rust 编译器提供了非常强大的配置能力。要掌握它们，需要花费大量的时间，你可以看一下 <a href="https://doc.rust-lang.org/reference/attributes.html#attributes" target="_blank" rel="noreferrer">Attributes</a> 相关资料。这也印证了 Rust 的适用面极其广泛。即使一个熟练的程序员，也没必要掌握全部，只需要了解其中的常见属性就可以。然后在遇到一些具体的场景时，再深入研究那些配置。</p><p>而如果我们要定义自己的“属性”，就需要通过属性宏来实现。这属于偏高级而且用得比较少的内容，需要的时候再去学习也来得及。具体的实现可以参考我给出的链接。</p><ul><li><a href="https://earthly.dev/blog/rust-macros/" target="_blank" rel="noreferrer">https://earthly.dev/blog/rust-macros/</a></li><li><a href="https://doc.rust-lang.org/beta/reference/procedural-macros.html" target="_blank" rel="noreferrer">https://doc.rust-lang.org/beta/reference/procedural-macros.html</a></li></ul><p>比如著名的 Web 开发框架 Rocket，就使用属性宏来配置 URL mapping。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#[macro_use] </span><span style="color:#C678DD;">extern</span><span style="color:#C678DD;"> crate</span><span style="color:#ABB2BF;"> rocket;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#[get(</span><span style="color:#98C379;">&quot;/&lt;name&gt;/&lt;age&gt;&quot;</span><span style="color:#ABB2BF;">)]      </span><span style="color:#7F848E;font-style:italic;">// 属性宏</span></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> hello</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: &amp;</span><span style="color:#E5C07B;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">age</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">u8</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">    format!</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Hello, {} year old named {}!&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">age</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#[launch]      </span><span style="color:#7F848E;font-style:italic;">// 属性宏</span></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> rocket</span><span style="color:#ABB2BF;">() -&gt; </span><span style="color:#E06C75;">_</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">    rocket</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">mount</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/hello&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#61AFEF;">routes!</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">hello</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>可以看到，有了属性宏的加持，Rust 代码在结构上变得相当紧凑而有美感，跟 Java 的 Spring 框架有点相似了。</p><h3 id="认识过程宏之函数宏" tabindex="-1">认识过程宏之函数宏 <a class="header-anchor" href="#认识过程宏之函数宏" aria-label="Permalink to &quot;认识过程宏之函数宏&quot;">​</a></h3><p>在某些特定的情况下，函数宏能更好地表达业务需求，比如写 SQL 语句。我们在 Rust 中撰写 SQL 语句，必须符合 Rust 的语法，因此，一般使用字符串来构造和传递 SQL 语句，比如：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> foo</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> sql</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;select title, content from article where id=&#39;1111111&#39;;&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>其实就不是那么方便，还容易出错。如果用函数宏来实现的话，可以做到如下效果：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 这是伪代码</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> sql_macros</span><span style="color:#ABB2BF;">::sqlbuilder;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> foo</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#61AFEF;">    sqlbuilder!</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">select</span><span style="color:#E06C75;"> title</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">content</span><span style="color:#E06C75;"> from</span><span style="color:#E06C75;"> article</span><span style="color:#C678DD;"> where</span><span style="color:#E06C75;"> id</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;1111111&#39;</span><span style="color:#ABB2BF;">;);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这样写，就好像在一个在 SQL 编辑器里面写 SQL 语句一样，非常自然，而不是把 SQL 语句写成字符串的形式了。也就是说，可以在 Rust 代码中写非 Rust 语法的代码，有没有感觉很神奇。当你想自己造一个 DSL（领域特定语言 Domain Specific Language ）时，函数宏就可以派上用场了。</p><p>函数宏是过程宏的一种，也使用过程宏的方式来实现，相关信息可参考我给出的 <a href="https://veykril.github.io/tlborm/proc-macros/methodical/function-like.html" target="_blank" rel="noreferrer">链接</a>。目前社区中关于过程宏完整而细致的教程并不多，后面我会出一系列这方面的专题教程。</p><h2 id="宏的应用" tabindex="-1">宏的应用 <a class="header-anchor" href="#宏的应用" aria-label="Permalink to &quot;宏的应用&quot;">​</a></h2><p>综上，我们可以看到，利用宏可以做到以下几方面的事情。</p><ol><li>减少重复代码。如果有大量的样板代码，可以使用声明宏或派生宏让代码变得更简洁、紧凑。</li><li>为类型添加额外能力。这是派生宏和属性宏的强大威力。</li><li>创建 DSL。可以自己创建一种新的语言，利用 Rust 编译器在 Rust 中编译运行，而不需要你自己再去写一个单独的编译器或解释器了。</li><li>变换代码实现任意自定义目标。本质上来说，宏就是对代码的变换，并且是在真正的编译阶段之前完成的，因此你可以用宏实现任意天马行空的想法。</li></ol><h2 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h2><p><img src="/tanggang_rust/assets/10317a770528e280a4176d0fbd877c03.CeHmWvhl.jpg" alt=""></p><p>宏在 Rust 里无处不在，我们学习的第一步是要认识它们，知道它们的作用，熟悉常见宏的意义和用法。然后要初步掌握写简单的声明宏的写法，这样能有效地提升你精简业务代码的能力。但同时也要注意，使用宏不能过度，宏的缺点是比较难调试，IDE 对它的支持可能也不完美。滥用宏会导致代码难以理解。</p><p>过程宏的能力非常强，书写的难度也比较大，我们目前不需要掌握它的写法。当你遇到一个过程宏的时候，你可以先查阅文档，知道它的作用，做到会用。等遇到需要的场景的时候，再去深入钻研。</p><p>这节课我们还提到了一个用来展开宏代码的工具 cargo expand，经常使用它，对你学习宏会有很大帮助。</p><h2 id="思考题" tabindex="-1">思考题 <a class="header-anchor" href="#思考题" aria-label="Permalink to &quot;思考题&quot;">​</a></h2><p>学完这节课的内容，你可以查阅一下相关资料，说一说 <code>allow</code>、 <code>warn</code>、 <code>deny</code>、 <code>forbid</code> 几个属性的意义和用法。欢迎你把查阅到的内容分享到评论区，如果觉得有收获的话，也欢迎你把这节课的内容分享给其他朋友，我们下节课再见！</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/muyaCode/FrontEndLearnNotes/edit/main/docs/Document/19｜Rust的宏体系：为自己的项目写一个简单的声明宏.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> 在 GitHub 上编辑此页<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>上次更新：: <time datetime="2025-02-28T18:19:24.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/tanggang_rust/Document/18%EF%BD%9C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%9A%E9%94%99%E8%AF%AF%E7%9A%84%E6%9E%84%E5%BB%BA%E3%80%81%E4%BC%A0%E9%80%92%E5%92%8C%E5%A4%84%E7%90%86" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>上一篇</span><span class="title" data-v-e257564d>18｜错误处理系统：错误的构建、传递和处理</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/tanggang_rust/Document/20%EF%BD%9C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%9ARust%E5%A6%82%E4%BD%95%E5%81%9A%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AC%A6%E5%8F%B7%E6%A0%87%E6%B3%A8%EF%BC%9F" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>下一篇</span><span class="title" data-v-e257564d>20｜生命周期：Rust如何做基本的生命周期符号标注？</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Released under the MIT License.</p><p class="copyright" data-v-e315a0ad>Copyright © 2025  MuYa</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"document_00｜开篇词｜拥抱rust浪潮，迎接更极致的编程体验.md\":\"Bx6ruBRE\",\"document_01｜快速入门：rust中有哪些你不得不了解的基础语法？.md\":\"YEQ1UjRq\",\"document_02｜所有权（上）：rust是如何管理程序中的资源的？.md\":\"Bvb116GB\",\"document_03｜所有权（下）：rust中借用与引用的规则是怎样的？.md\":\"BJwhWwWd\",\"document_04｜字符串：对号入座，字符串其实没那么可怕！.md\":\"Bv5l_4z9\",\"document_05｜复合类型（上）：结构体与面向对象特性.md\":\"CITkKTJg\",\"document_06｜复合类型（下）：枚举与模式匹配.md\":\"Ct8Xedp7\",\"document_07｜类型与类型参数：给rust小助手提供更多信息.md\":\"EbjW2AkC\",\"document_08｜option-t-与result-t_e-、迭代器.md\":\"BNKn_0uw\",\"document_09｜初识trait：协议约束与能力配置.md\":\"llurKKcW\",\"document_10｜再探trait：带类型参数的trait及traitobject.md\":\"CMwHA5A-\",\"document_11｜常见trait解析：标准库中的常见trait应该怎么用？.md\":\"BGa5CpQf\",\"document_12｜智能指针：从所有权看智能指针.md\":\"Cxvwfxu6\",\"document_13｜独立王国：初步了解rust异步并发编程.md\":\"DSU5sdFT\",\"document_14｜tokio实战：编写一个网络命令行程序.md\":\"C1JeQOSl\",\"document_15｜tokio编程：在多任务之间操作同一片数据.md\":\"Bwzc0tpF\",\"document_16｜tokio编程：使用channel在不同任务间通信？.md\":\"DKrhaVoh\",\"document_17｜tokio编程：rust异步编程还有哪些需要注意的点？.md\":\"CmxLkup0\",\"document_18｜错误处理系统：错误的构建、传递和处理.md\":\"BWw-vDDL\",\"document_19｜rust的宏体系：为自己的项目写一个简单的声明宏.md\":\"DXluFKAD\",\"document_20｜生命周期：rust如何做基本的生命周期符号标注？.md\":\"Bt1xgIs6\",\"document_21｜web开发（上）：如何使用axum框架进行web后端开发？.md\":\"DXd_p46T\",\"document_22｜web开发（下）：如何实现一个todolist应用？.md\":\"Bi1r-Ulj\",\"document_23｜rust与大模型：用candle做一个聊天机器人.md\":\"CDaEmFi3\",\"document_24｜rust图像识别：利用yolov8识别对象.md\":\"CMFa5k75\",\"document_25｜rustgui编程：用slint为chatbot实现一个界面.md\":\"CSQiE64f\",\"document_26｜rustgui编程：用slint为yolov8实现一个界面.md\":\"8_AGledo\",\"document_27｜rustbevy游戏开发：用300行代码做一个贪吃蛇游戏.md\":\"DcZ-wJin\",\"document_28｜nom：用rust写一个parser解析器.md\":\"DtpKzSZI\",\"document_29｜unsafe编程（上）：unsaferust中那些被封印的能力.md\":\"DkGls-cm\",\"document_30｜unsafe编程（下）：使用rust为python写一个扩展.md\":\"tPXz85a6\",\"document_答疑课堂（一）｜第一章rust基础篇思考题答案.md\":\"CC_0mUbW\",\"document_答疑课堂（三）｜第三章rust应用篇思考题答案.md\":\"He3Na2GY\",\"document_答疑课堂（二）｜第二章rust进阶篇思考题答案.md\":\"rq96ZBKO\",\"document_结束语｜未来让rust带你“锈”到起飞.md\":\"CDoEtXUj\",\"document_结课测试｜来赴一场满分之约.md\":\"BDMdH3Zr\",\"index.md\":\"ZlsnMKnR\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh\",\"dir\":\"ltr\",\"title\":\"唐刚-Rust语言从入门到实战\",\"description\":\"Rust语言从入门到实战\",\"base\":\"/tanggang_rust/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/img/buding.svg\",\"siteTitle\":\"Rust语言从入门到实战\",\"outlineTitle\":\"⚡️文档内容大纲\",\"outline\":\"deep\",\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"displayDetails\":\"显示详细信息\",\"resetButtonTitle\":\"清除查询条件\",\"backButtonTitle\":\"返回搜索结果\",\"footer\":{\"selectText\":\"选择\",\"selectKeyAriaLabel\":\"enter\",\"navigateText\":\"切换\",\"navigateUpKeyAriaLabel\":\"up arrow\",\"navigateDownKeyAriaLabel\":\"down arrow\",\"closeText\":\"关闭\",\"closeKeyAriaLabel\":\"escape\"}}}}},\"miniSearch\":{\"options\":{},\"searchOptions\":{}}}},\"sidebar\":{\"/\":[{\"text\":\"00｜开篇词｜拥抱Rust浪潮，迎接更极致的编程体验\",\"link\":\"/Document/00｜开篇词｜拥抱Rust浪潮，迎接更极致的编程体验\"},{\"text\":\"01｜快速入门：Rust中有哪些你不得不了解的基础语法？\",\"link\":\"/Document/01｜快速入门：Rust中有哪些你不得不了解的基础语法？\"},{\"text\":\"02｜所有权（上）：Rust是如何管理程序中的资源的？\",\"link\":\"/Document/02｜所有权（上）：Rust是如何管理程序中的资源的？\"},{\"text\":\"03｜所有权（下）：Rust中借用与引用的规则是怎样的？\",\"link\":\"/Document/03｜所有权（下）：Rust中借用与引用的规则是怎样的？\"},{\"text\":\"04｜字符串：对号入座，字符串其实没那么可怕！\",\"link\":\"/Document/04｜字符串：对号入座，字符串其实没那么可怕！\"},{\"text\":\"05｜复合类型（上）：结构体与面向对象特性\",\"link\":\"/Document/05｜复合类型（上）：结构体与面向对象特性\"},{\"text\":\"06｜复合类型（下）：枚举与模式匹配\",\"link\":\"/Document/06｜复合类型（下）：枚举与模式匹配\"},{\"text\":\"07｜类型与类型参数：给Rust小助手提供更多信息\",\"link\":\"/Document/07｜类型与类型参数：给Rust小助手提供更多信息\"},{\"text\":\"08｜Option-T-与Result-T,E-、迭代器\",\"link\":\"/Document/08｜Option-T-与Result-T,E-、迭代器\"},{\"text\":\"09｜初识trait：协议约束与能力配置\",\"link\":\"/Document/09｜初识trait：协议约束与能力配置\"},{\"text\":\"10｜再探trait：带类型参数的trait及traitobject\",\"link\":\"/Document/10｜再探trait：带类型参数的trait及traitobject\"},{\"text\":\"11｜常见trait解析：标准库中的常见trait应该怎么用？\",\"link\":\"/Document/11｜常见trait解析：标准库中的常见trait应该怎么用？\"},{\"text\":\"答疑课堂（一）｜第一章Rust基础篇思考题答案\",\"link\":\"/Document/答疑课堂（一）｜第一章Rust基础篇思考题答案\"},{\"text\":\"12｜智能指针：从所有权看智能指针\",\"link\":\"/Document/12｜智能指针：从所有权看智能指针\"},{\"text\":\"13｜独立王国：初步了解Rust异步并发编程\",\"link\":\"/Document/13｜独立王国：初步了解Rust异步并发编程\"},{\"text\":\"14｜tokio实战：编写一个网络命令行程序\",\"link\":\"/Document/14｜tokio实战：编写一个网络命令行程序\"},{\"text\":\"15｜tokio编程：在多任务之间操作同一片数据\",\"link\":\"/Document/15｜tokio编程：在多任务之间操作同一片数据\"},{\"text\":\"16｜tokio编程：使用channel在不同任务间通信？\",\"link\":\"/Document/16｜tokio编程：使用channel在不同任务间通信？\"},{\"text\":\"17｜tokio编程：Rust异步编程还有哪些需要注意的点？\",\"link\":\"/Document/17｜tokio编程：Rust异步编程还有哪些需要注意的点？\"},{\"text\":\"18｜错误处理系统：错误的构建、传递和处理\",\"link\":\"/Document/18｜错误处理系统：错误的构建、传递和处理\"},{\"text\":\"19｜Rust的宏体系：为自己的项目写一个简单的声明宏\",\"link\":\"/Document/19｜Rust的宏体系：为自己的项目写一个简单的声明宏\"},{\"text\":\"20｜生命周期：Rust如何做基本的生命周期符号标注？\",\"link\":\"/Document/20｜生命周期：Rust如何做基本的生命周期符号标注？\"},{\"text\":\"答疑课堂（二）｜第二章Rust进阶篇思考题答案\",\"link\":\"/Document/答疑课堂（二）｜第二章Rust进阶篇思考题答案\"},{\"text\":\"21｜Web开发（上）：如何使用Axum框架进行Web后端开发？\",\"link\":\"/Document/21｜Web开发（上）：如何使用Axum框架进行Web后端开发？\"},{\"text\":\"22｜Web开发（下）：如何实现一个TodoList应用？\",\"link\":\"/Document/22｜Web开发（下）：如何实现一个TodoList应用？\"},{\"text\":\"23｜Rust与大模型：用Candle做一个聊天机器人\",\"link\":\"/Document/23｜Rust与大模型：用Candle做一个聊天机器人\"},{\"text\":\"24｜Rust图像识别：利用YOLOv8识别对象\",\"link\":\"/Document/24｜Rust图像识别：利用YOLOv8识别对象\"},{\"text\":\"25｜RustGUI编程：用Slint为Chatbot实现一个界面\",\"link\":\"/Document/25｜RustGUI编程：用Slint为Chatbot实现一个界面\"},{\"text\":\"26｜RustGUI编程：用Slint为YOLOv8实现一个界面\",\"link\":\"/Document/26｜RustGUI编程：用Slint为YOLOv8实现一个界面\"},{\"text\":\"27｜RustBevy游戏开发：用300行代码做一个贪吃蛇游戏\",\"link\":\"/Document/27｜RustBevy游戏开发：用300行代码做一个贪吃蛇游戏\"},{\"text\":\"28｜Nom：用Rust写一个Parser解析器\",\"link\":\"/Document/28｜Nom：用Rust写一个Parser解析器\"},{\"text\":\"29｜Unsafe编程（上）：UnsafeRust中那些被封印的能力\",\"link\":\"/Document/29｜Unsafe编程（上）：UnsafeRust中那些被封印的能力\"},{\"text\":\"30｜Unsafe编程（下）：使用Rust为Python写一个扩展\",\"link\":\"/Document/30｜Unsafe编程（下）：使用Rust为Python写一个扩展\"},{\"text\":\"答疑课堂（三）｜第三章Rust应用篇思考题答案\",\"link\":\"/Document/答疑课堂（三）｜第三章Rust应用篇思考题答案\"},{\"text\":\"结课测试｜来赴一场满分之约\",\"link\":\"/Document/结课测试｜来赴一场满分之约\"},{\"text\":\"结束语｜未来让Rust带你“锈”到起飞\",\"link\":\"/Document/结束语｜未来让Rust带你“锈”到起飞\"}]},\"editLink\":{\"pattern\":\"https://github.com/muyaCode/FrontEndLearnNotes/edit/main/docs/:path\",\"text\":\"在 GitHub 上编辑此页\"},\"lastUpdated\":{\"text\":\"上次更新：\",\"formatOptions\":{\"dateStyle\":\"full\",\"timeStyle\":\"medium\"}},\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2025  MuYa\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>