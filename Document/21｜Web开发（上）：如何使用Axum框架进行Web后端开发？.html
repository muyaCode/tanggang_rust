<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>21 ｜ Web 开发（上）：如何使用 Axum 框架进行 Web 后端开发？ | 唐刚-Rust语言从入门到实战</title>
    <meta name="description" content="Rust语言从入门到实战">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/tanggang_rust/assets/style.Dmb1gw5t.css" as="style">
    <link rel="preload stylesheet" href="/tanggang_rust/vp-icons.css" as="style">
    
    <script type="module" src="/tanggang_rust/assets/app.DakBAcEX.js"></script>
    <link rel="preload" href="/tanggang_rust/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/tanggang_rust/assets/chunks/theme.BYwnybAk.js">
    <link rel="modulepreload" href="/tanggang_rust/assets/chunks/framework.D2WelYEY.js">
    <link rel="modulepreload" href="/tanggang_rust/assets/Document_21｜Web开发（上）：如何使用Axum框架进行Web后端开发？.md.DXd_p46T.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/tanggang_rust/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/tanggang_rust/img/buding.svg" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>Rust语言从入门到实战</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/00%EF%BD%9C%E5%BC%80%E7%AF%87%E8%AF%8D%EF%BD%9C%E6%8B%A5%E6%8A%B1Rust%E6%B5%AA%E6%BD%AE%EF%BC%8C%E8%BF%8E%E6%8E%A5%E6%9B%B4%E6%9E%81%E8%87%B4%E7%9A%84%E7%BC%96%E7%A8%8B%E4%BD%93%E9%AA%8C" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>00｜开篇词｜拥抱Rust浪潮，迎接更极致的编程体验</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/01%EF%BD%9C%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%EF%BC%9ARust%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BD%A0%E4%B8%8D%E5%BE%97%E4%B8%8D%E4%BA%86%E8%A7%A3%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>01｜快速入门：Rust中有哪些你不得不了解的基础语法？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/02%EF%BD%9C%E6%89%80%E6%9C%89%E6%9D%83%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9ARust%E6%98%AF%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E8%B5%84%E6%BA%90%E7%9A%84%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>02｜所有权（上）：Rust是如何管理程序中的资源的？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/03%EF%BD%9C%E6%89%80%E6%9C%89%E6%9D%83%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9ARust%E4%B8%AD%E5%80%9F%E7%94%A8%E4%B8%8E%E5%BC%95%E7%94%A8%E7%9A%84%E8%A7%84%E5%88%99%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>03｜所有权（下）：Rust中借用与引用的规则是怎样的？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/04%EF%BD%9C%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9A%E5%AF%B9%E5%8F%B7%E5%85%A5%E5%BA%A7%EF%BC%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%85%B6%E5%AE%9E%E6%B2%A1%E9%82%A3%E4%B9%88%E5%8F%AF%E6%80%95%EF%BC%81" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>04｜字符串：对号入座，字符串其实没那么可怕！</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/05%EF%BD%9C%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%89%B9%E6%80%A7" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>05｜复合类型（上）：结构体与面向对象特性</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/06%EF%BD%9C%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E6%9E%9A%E4%B8%BE%E4%B8%8E%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>06｜复合类型（下）：枚举与模式匹配</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/07%EF%BD%9C%E7%B1%BB%E5%9E%8B%E4%B8%8E%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0%EF%BC%9A%E7%BB%99Rust%E5%B0%8F%E5%8A%A9%E6%89%8B%E6%8F%90%E4%BE%9B%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>07｜类型与类型参数：给Rust小助手提供更多信息</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/08%EF%BD%9COption-T-%E4%B8%8EResult-T,E-%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>08｜Option-T-与Result-T,E-、迭代器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/09%EF%BD%9C%E5%88%9D%E8%AF%86trait%EF%BC%9A%E5%8D%8F%E8%AE%AE%E7%BA%A6%E6%9D%9F%E4%B8%8E%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>09｜初识trait：协议约束与能力配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/10%EF%BD%9C%E5%86%8D%E6%8E%A2trait%EF%BC%9A%E5%B8%A6%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0%E7%9A%84trait%E5%8F%8Atraitobject" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>10｜再探trait：带类型参数的trait及traitobject</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/11%EF%BD%9C%E5%B8%B8%E8%A7%81trait%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%A0%87%E5%87%86%E5%BA%93%E4%B8%AD%E7%9A%84%E5%B8%B8%E8%A7%81trait%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E7%94%A8%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>11｜常见trait解析：标准库中的常见trait应该怎么用？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%EF%BC%88%E4%B8%80%EF%BC%89%EF%BD%9C%E7%AC%AC%E4%B8%80%E7%AB%A0Rust%E5%9F%BA%E7%A1%80%E7%AF%87%E6%80%9D%E8%80%83%E9%A2%98%E7%AD%94%E6%A1%88" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>答疑课堂（一）｜第一章Rust基础篇思考题答案</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/12%EF%BD%9C%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%EF%BC%9A%E4%BB%8E%E6%89%80%E6%9C%89%E6%9D%83%E7%9C%8B%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>12｜智能指针：从所有权看智能指针</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/13%EF%BD%9C%E7%8B%AC%E7%AB%8B%E7%8E%8B%E5%9B%BD%EF%BC%9A%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3Rust%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>13｜独立王国：初步了解Rust异步并发编程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/14%EF%BD%9Ctokio%E5%AE%9E%E6%88%98%EF%BC%9A%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%A8%8B%E5%BA%8F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>14｜tokio实战：编写一个网络命令行程序</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/15%EF%BD%9Ctokio%E7%BC%96%E7%A8%8B%EF%BC%9A%E5%9C%A8%E5%A4%9A%E4%BB%BB%E5%8A%A1%E4%B9%8B%E9%97%B4%E6%93%8D%E4%BD%9C%E5%90%8C%E4%B8%80%E7%89%87%E6%95%B0%E6%8D%AE" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>15｜tokio编程：在多任务之间操作同一片数据</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/16%EF%BD%9Ctokio%E7%BC%96%E7%A8%8B%EF%BC%9A%E4%BD%BF%E7%94%A8channel%E5%9C%A8%E4%B8%8D%E5%90%8C%E4%BB%BB%E5%8A%A1%E9%97%B4%E9%80%9A%E4%BF%A1%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>16｜tokio编程：使用channel在不同任务间通信？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/17%EF%BD%9Ctokio%E7%BC%96%E7%A8%8B%EF%BC%9ARust%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E8%BF%98%E6%9C%89%E5%93%AA%E4%BA%9B%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%82%B9%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>17｜tokio编程：Rust异步编程还有哪些需要注意的点？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/18%EF%BD%9C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%9A%E9%94%99%E8%AF%AF%E7%9A%84%E6%9E%84%E5%BB%BA%E3%80%81%E4%BC%A0%E9%80%92%E5%92%8C%E5%A4%84%E7%90%86" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>18｜错误处理系统：错误的构建、传递和处理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/19%EF%BD%9CRust%E7%9A%84%E5%AE%8F%E4%BD%93%E7%B3%BB%EF%BC%9A%E4%B8%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A3%B0%E6%98%8E%E5%AE%8F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>19｜Rust的宏体系：为自己的项目写一个简单的声明宏</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/20%EF%BD%9C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%9ARust%E5%A6%82%E4%BD%95%E5%81%9A%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AC%A6%E5%8F%B7%E6%A0%87%E6%B3%A8%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>20｜生命周期：Rust如何做基本的生命周期符号标注？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BD%9C%E7%AC%AC%E4%BA%8C%E7%AB%A0Rust%E8%BF%9B%E9%98%B6%E7%AF%87%E6%80%9D%E8%80%83%E9%A2%98%E7%AD%94%E6%A1%88" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>答疑课堂（二）｜第二章Rust进阶篇思考题答案</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/21%EF%BD%9CWeb%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Axum%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8CWeb%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>21｜Web开发（上）：如何使用Axum框架进行Web后端开发？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/22%EF%BD%9CWeb%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AATodoList%E5%BA%94%E7%94%A8%EF%BC%9F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>22｜Web开发（下）：如何实现一个TodoList应用？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/23%EF%BD%9CRust%E4%B8%8E%E5%A4%A7%E6%A8%A1%E5%9E%8B%EF%BC%9A%E7%94%A8Candle%E5%81%9A%E4%B8%80%E4%B8%AA%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>23｜Rust与大模型：用Candle做一个聊天机器人</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/24%EF%BD%9CRust%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%EF%BC%9A%E5%88%A9%E7%94%A8YOLOv8%E8%AF%86%E5%88%AB%E5%AF%B9%E8%B1%A1" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>24｜Rust图像识别：利用YOLOv8识别对象</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/25%EF%BD%9CRustGUI%E7%BC%96%E7%A8%8B%EF%BC%9A%E7%94%A8Slint%E4%B8%BAChatbot%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%95%8C%E9%9D%A2" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>25｜RustGUI编程：用Slint为Chatbot实现一个界面</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/26%EF%BD%9CRustGUI%E7%BC%96%E7%A8%8B%EF%BC%9A%E7%94%A8Slint%E4%B8%BAYOLOv8%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%95%8C%E9%9D%A2" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>26｜RustGUI编程：用Slint为YOLOv8实现一个界面</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/27%EF%BD%9CRustBevy%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%EF%BC%9A%E7%94%A8300%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%81%9A%E4%B8%80%E4%B8%AA%E8%B4%AA%E5%90%83%E8%9B%87%E6%B8%B8%E6%88%8F" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>27｜RustBevy游戏开发：用300行代码做一个贪吃蛇游戏</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/28%EF%BD%9CNom%EF%BC%9A%E7%94%A8Rust%E5%86%99%E4%B8%80%E4%B8%AAParser%E8%A7%A3%E6%9E%90%E5%99%A8" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>28｜Nom：用Rust写一个Parser解析器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/29%EF%BD%9CUnsafe%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9AUnsafeRust%E4%B8%AD%E9%82%A3%E4%BA%9B%E8%A2%AB%E5%B0%81%E5%8D%B0%E7%9A%84%E8%83%BD%E5%8A%9B" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>29｜Unsafe编程（上）：UnsafeRust中那些被封印的能力</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/30%EF%BD%9CUnsafe%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8Rust%E4%B8%BAPython%E5%86%99%E4%B8%80%E4%B8%AA%E6%89%A9%E5%B1%95" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>30｜Unsafe编程（下）：使用Rust为Python写一个扩展</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%EF%BC%88%E4%B8%89%EF%BC%89%EF%BD%9C%E7%AC%AC%E4%B8%89%E7%AB%A0Rust%E5%BA%94%E7%94%A8%E7%AF%87%E6%80%9D%E8%80%83%E9%A2%98%E7%AD%94%E6%A1%88" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>答疑课堂（三）｜第三章Rust应用篇思考题答案</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%BB%93%E8%AF%BE%E6%B5%8B%E8%AF%95%EF%BD%9C%E6%9D%A5%E8%B5%B4%E4%B8%80%E5%9C%BA%E6%BB%A1%E5%88%86%E4%B9%8B%E7%BA%A6" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>结课测试｜来赴一场满分之约</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tanggang_rust/Document/%E7%BB%93%E6%9D%9F%E8%AF%AD%EF%BD%9C%E6%9C%AA%E6%9D%A5%E8%AE%A9Rust%E5%B8%A6%E4%BD%A0%E2%80%9C%E9%94%88%E2%80%9D%E5%88%B0%E8%B5%B7%E9%A3%9E" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>结束语｜未来让Rust带你“锈”到起飞</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>⚡️文档内容大纲</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _tanggang_rust_Document_21%EF%BD%9CWeb%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Axum%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8CWeb%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%EF%BC%9F" data-v-39a288b8><div><h1 id="_21-web-开发-上-如何使用-axum-框架进行-web-后端开发" tabindex="-1">21 ｜ Web 开发（上）：如何使用 Axum 框架进行 Web 后端开发？ <a class="header-anchor" href="#_21-web-开发-上-如何使用-axum-框架进行-web-后端开发" aria-label="Permalink to &quot;21 ｜ Web 开发（上）：如何使用 Axum 框架进行 Web 后端开发？&quot;">​</a></h1><p>你好，我是 Mike, 今天我们来讲一讲如何用 Axum 框架进行 Web 服务器后端开发。</p><p>关于 Rust 是否适合做 Web 后端开发，很多人持怀疑态度。认为 Web 开发讲究的是敏捷，一种动态的、带运行时的、方便修改的语言可能更适合 Web 开发。</p><p>但有一些因素，其实决定了 Rust 非常适合 Web 开发。</p><ol><li>时代变化：芯片摩尔定律已失效，服务器成本逐渐占据相当大的比例，无脑堆服务器的时代已经过去。当前阶段，对于规模稍微大一些的公司来说，降本增效是一个很重要的任务。而 Rust 的高性能和稳定可靠的表现非常适合帮助公司节省服务器成本。</li><li>随着业务的成型，一些核心业务会趋于稳定，模型和流程抽象已经基本不会有大的改动。这时，使用 Rust 重写或部分重写这些业务，会带来更强的性能和更可靠稳定的服务表现。</li><li>Rust 非常适合用来做一些通用的中间件服务，目前开源社区已经出现了一些相当优秀的中间件产品。</li><li>Rust 的表达能力其实非常强，其强大的类型系统可帮助开发者轻松地对问题进行建模。一个中等熟练的 Rust 开发者做原型的速度不会比 Python 慢多少，在复杂问题场景下，甚至更快。</li><li>Rust 的语言层面的设计使它特别适合做重构。重构 Rust 工程特别快，重构完后，也不用担心出错的问题。相对于动态语言，对应的测试用例都可以少准备很多。</li></ol><h2 id="rust-web-backend-生态" tabindex="-1">Rust Web Backend 生态 <a class="header-anchor" href="#rust-web-backend-生态" aria-label="Permalink to &quot;Rust Web Backend 生态&quot;">​</a></h2><p>Rust Web 后端开发生态目前处于一种欣欣向荣的局面。就 Web 开发框架来说，能叫得上名字的就有十几种，其中按 <a href="https://crates.io" target="_blank" rel="noreferrer">crates.io</a> 最新下载量排名，排列靠前的是这几位。</p><ol><li>Axum</li><li>Actix-web</li><li>Rocket</li><li>Poem</li><li>Rouille</li><li>Salvo</li></ol><p>从最近下载的绝对数量来说，Axum 的下载量是第二名 Actix-web 的 3 倍多。因此，我们选择了下载量最多的框架——Axum。</p><h3 id="tokio-技术栈介绍" tabindex="-1">Tokio 技术栈介绍 <a class="header-anchor" href="#tokio-技术栈介绍" aria-label="Permalink to &quot;Tokio 技术栈介绍&quot;">​</a></h3><p>Axum 有这么强劲的表现，得益于其本身优秀的设计，还有它无缝依赖的 Tokio 技术栈。Tokio 从 2017 年发布 0.1 版本开始到现在，已经形成一套强大的技术栈。</p><p><img src="/tanggang_rust/assets/e1e84b20997c3a99540c7559e6dc5b40.BtQvjaj3.jpg" alt=""></p><p>这些可靠的工具链，为 Rust 在服务器端的发展打下了坚实的基础，越来越多的项目开始采用这一套技术栈。</p><h2 id="axum-框架" tabindex="-1">Axum 框架 <a class="header-anchor" href="#axum-框架" aria-label="Permalink to &quot;Axum 框架&quot;">​</a></h2><blockquote><p>Axum 是一个专注于人体工程学和模块化的 Web 开发框架。——官方文档的 Slogan</p></blockquote><p>从上层视角来看，Axum 具有以下特性：</p><ol><li>写 Router 和 Handler 的时候，不需要使用宏（非标注风格）。</li><li>使用解包器进行声明式的请求解析。</li><li>简单和可预测的错误处理模型。</li><li>生成响应时只需用到最小的样板代码。</li><li>充分利用 tower 和 tower-http 的中间件、服务和工具的生态系统。</li></ol><p>特别是最后一点，让 Axum 显著不同于其他框架。Axum 自己不带中间件系统，而是使用 tower 系的中间件。这样就能和生态里的其他项目，如 hyper 或 tonic 共享中间件系统。 这种设计太棒了。</p><h3 id="tower-中间层服务" tabindex="-1">Tower 中间层服务 <a class="header-anchor" href="#tower-中间层服务" aria-label="Permalink to &quot;Tower 中间层服务&quot;">​</a></h3><p>Tower 是一个模块化、可重用的组件系统，用于构建稳健的网络服务端和客户端应用。它对 <strong>请求/响应模型</strong> 做了一个统一的服务抽象，和具体的实现协议无关。你可以看一下 Service 的定义。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">async</span><span style="color:#61AFEF;"> fn</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Request</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#E5C07B;">Result</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Response</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Error</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Tower 包含 Service 和 Layer 两个抽象。一个 Service 是一个接受请求，做出响应的异步函数；而一个 Layer 接受一个 Service，处理并返回另一个 Service。Service 和 Layer 一起，就可以方便地构建中间件服务。而完全基于流（stream）的服务，并不适合使用 Tower。</p><h3 id="tower-http-介绍" tabindex="-1">Tower-http 介绍 <a class="header-anchor" href="#tower-http-介绍" aria-label="Permalink to &quot;Tower-http 介绍&quot;">​</a></h3><p><a href="https://docs.rs/tower-http/latest/tower_http/" target="_blank" rel="noreferrer">Tower-http</a> 是一个专门用于提供 HTTP 相关的中间件和设施的库，里面罗列了二十多个中间件。</p><p>在 Axum 中，最常用的中间件是下面这几个。</p><ul><li>TracyLayer 中间件，用于提供高层日志或跟踪。</li><li>CorsLayer 中间件，用于处理 CORS。</li><li>CompressionLayer 中间件，用于自动压缩响应。</li><li>RequestIdLayer 和 PropagateRequestIdLayer  中间件，用于设置和传播请求 ID。</li><li>TimeoutLayer 中间件，用于设置超时。</li><li>HandleErrorLayer 中间件，用于转换各种错误类型到响应。</li></ul><p>而每个中间件都可以用在全局 Router、模块 Router 和 Handler 三个层次。</p><h3 id="router" tabindex="-1">Router <a class="header-anchor" href="#router" aria-label="Permalink to &quot;Router&quot;">​</a></h3><p>Router 用来定义 URL 到 handler 的映射，并用来构建模块化 URL 的层级，既能支持全局性路由，也能支持模块层级的路由。比如：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> user_routes</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Router</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/:id&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">||</span><span style="color:#C678DD;"> async</span><span style="color:#ABB2BF;"> {}));</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> team_routes</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Router</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">||</span><span style="color:#C678DD;"> async</span><span style="color:#ABB2BF;"> {}));</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> api_routes</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Router</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">nest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/users&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">user_routes</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">nest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/teams&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">team_routes</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Router</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">nest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/api&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">api_routes</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="handler" tabindex="-1">Handler <a class="header-anchor" href="#handler" aria-label="Permalink to &quot;Handler&quot;">​</a></h3><p>在 Axum 里，Handler 是一个异步函数，这个异步函数接受一个或多个解包器作为参数，返回一个可以转换为响应（impl IntoResponse）的类型。</p><p>最简单的 handler 类似下面这个样子：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> fn</span><span style="color:#61AFEF;"> string_handler</span><span style="color:#ABB2BF;">() -&gt; </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">    &quot;Hello, World!&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">to_string</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="使用-axum-进行-web-后端开发" tabindex="-1">使用 Axum 进行 Web 后端开发 <a class="header-anchor" href="#使用-axum-进行-web-后端开发" aria-label="Permalink to &quot;使用 Axum 进行 Web 后端开发&quot;">​</a></h2><p>现在话不多说，让我们开始 Axum 实战环节吧！</p><p>注：目前（2023 年 12 月）Axum 的最新版本是 v0.7 版，我们下面会基于这个版本来编写代码。</p><h3 id="第一步-hello-world" tabindex="-1">第一步：Hello world <a class="header-anchor" href="#第一步-hello-world" aria-label="Permalink to &quot;第一步：Hello world&quot;">​</a></h3><p>我们先来看看 Axum 的 Hello World 是什么样子。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> axum</span><span style="color:#ABB2BF;">::{</span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Html</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">routing</span><span style="color:#ABB2BF;">::get, </span><span style="color:#E5C07B;">Router</span><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#[tokio::main]</span></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> fn</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // build our application with a route</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Router</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">handler</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // run it</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> listener</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> tokio</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">net</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">TcpListener</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">bind</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;127.0.0.1:3000&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#C678DD;">await</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">unwrap</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">    println!</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;listening on {}&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">listener</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">local_addr</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">unwrap</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;">    axum</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">serve</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">listener</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">app</span><span style="color:#ABB2BF;">).</span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">unwrap</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> fn</span><span style="color:#61AFEF;"> handler</span><span style="color:#ABB2BF;">() -&gt; </span><span style="color:#E5C07B;">Html</span><span style="color:#ABB2BF;">&lt;&amp;&#39;</span><span style="color:#E5C07B;">static</span><span style="color:#E5C07B;"> str</span><span style="color:#ABB2BF;">&gt; {</span></span>
<span class="line"><span style="color:#61AFEF;">    Html</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;&lt;h1&gt;Hello, World!&lt;/h1&gt;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>这里我给出这个步骤的 <a href="https://github.com/miketang84/jikeshijian/tree/master/2122-axumapp_stepbystep/axumapp01_helloworld" target="_blank" rel="noreferrer">原始代码地址</a>，你可以直接下载到本地运行。</p><p>从这个例子里，我们可以一窥 Axum 应用的基本结构。首先，一个 Axum 应用其实就是一个 Tokio 应用，以标志性的 tokio::main 属性宏开头。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#[tokio::main]</span></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> fn</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">() {</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后，创建一个 Router 实例，代表 App。在 Router 中，绑定 URL 与 handler。</p><p>然后使用 <code>tokio::net::TcpListener::bind()</code> 监听服务器地址，并将生成的 listener 传入 <code>axum::serve()</code> 中使用，启动 axum 服务。而这个应用的 handler 参数里没有解包器（extractor），是因为我们暂时不解析请求参数，所以参数部分留空。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> fn</span><span style="color:#61AFEF;"> handler</span><span style="color:#ABB2BF;">() -&gt; </span><span style="color:#E5C07B;">Html</span><span style="color:#ABB2BF;">&lt;&amp;&#39;</span><span style="color:#E5C07B;">static</span><span style="color:#E5C07B;"> str</span><span style="color:#ABB2BF;">&gt; {</span></span>
<span class="line"><span style="color:#61AFEF;">    Html</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;&lt;h1&gt;Hello, World!&lt;/h1&gt;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后，这个 handler 的返回值是 <code>Html&lt;&amp;&#39;static str&gt;</code> 类型，它已经实现了 IntoResponse，所以可以作为 Response 返回类型。下面我们来测试，打开终端在代码目录下执行 <code>cargo run</code>。终端下输出 <code>listening on 127.0.0.1:3000</code>。</p><p>打开浏览器，输入 <code>127.0.0.1:3000</code>，可以看到下面这样的页面效果。</p><p><img src="/tanggang_rust/assets/d757695525f1fd973f4532bf7475fdcb.Del1ycrw.png" alt="图片"></p><h3 id="第二步-实现静态文件服务" tabindex="-1">第二步：实现静态文件服务 <a class="header-anchor" href="#第二步-实现静态文件服务" aria-label="Permalink to &quot;第二步：实现静态文件服务&quot;">​</a></h3><p>静态文件服务非常有用，用于对服务器上的静态资源如图片、HTML、JS、CSS 等文件提供服务。下面我们来看看如何使用 Axum 实现一个简单的静态文件服务。我们只需要引入 ServeDir 服务，然后在 Router 实例上使用 nest_service 挂载这个服务就可以了。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">    Router</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">nest_service</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/assets&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">ServeDir</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;assets&quot;</span><span style="color:#ABB2BF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>ServeDir::new()</code> 的参数是资源目录的路径，上面一句表示把 <code>/assets/*</code> 的 URL 映射到 assets 目录下的哪些文件。</p><p>而如果需要配置获取默认文件，可以按照下面这样，在 ServeDir 里配置 not_found_service，传一个 ServeFile 实例进去，这个 ServeFile 实例就是默认获取的那个文件。然后在 Router 实例配置时，添加一个 fallback_service 挂载 serve_dir。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> serve_dir</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#E5C07B;">    ServeDir</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;assets2&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">not_found_service</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ServeFile</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;assets2/index.html&quot;</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Router</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/foo&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">handler</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">nest_service</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/assets&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">ServeDir</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;assets&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">nest_service</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/assets2&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">serve_dir</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">clone</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">fallback_service</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">serve_dir</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上述示例里，即使我们访问一些不存在的 URL 地址，服务器也会返回 assets2 目录下的 index.html 文件。这通常正是我们想要的。你可以根据 <a href="https://github.com/miketang84/jikeshijian/tree/master/2122-axumapp_stepbystep/axumapp02_staticfile" target="_blank" rel="noreferrer">示例源码</a> 自行测试，查看效果。</p><p>你可以尝试如下 URL 地址：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>http://127.0.0.1:3000/</span></span>
<span class="line"><span>http://127.0.0.1:3000/foo</span></span>
<span class="line"><span>http://127.0.0.1:3000/bar</span></span>
<span class="line"><span>http://127.0.0.1:3000/assets/index.html</span></span>
<span class="line"><span>http://127.0.0.1:3000/assets/ferris.png</span></span>
<span class="line"><span>http://127.0.0.1:3000/assets/script.js</span></span>
<span class="line"><span>http://127.0.0.1:3000/assets2/index.html</span></span>
<span class="line"><span>http://127.0.0.1:3000/assets2/ferris2.png</span></span>
<span class="line"><span>http://127.0.0.1:3000/assets2/script.js</span></span>
<span class="line"><span>...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="第三步-加入日志记录" tabindex="-1">第三步：加入日志记录 <a class="header-anchor" href="#第三步-加入日志记录" aria-label="Permalink to &quot;第三步：加入日志记录&quot;">​</a></h3><p>日志系统是一个服务必不可少的组件，我们一起来看看如何为 Axum 应用添加日志。在 Axum 中添加日志很简单。第一步，我们需要添加 tracing 和 tracing-subscriber 两个 crates。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E06C75;">cargo</span><span style="color:#E06C75;"> add</span><span style="color:#E06C75;"> tracing</span></span>
<span class="line"><span style="color:#E06C75;">cargo</span><span style="color:#E06C75;"> add</span><span style="color:#E06C75;"> tracing</span><span style="color:#ABB2BF;">-</span><span style="color:#E06C75;">subscriber</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后引入 TraceLayer。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> tower_http</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">trace</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">TraceLayer</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>在 main 函数的开头添加代码：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">    tracing_subscriber</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">fmt</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">init</span><span style="color:#ABB2BF;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>再在 Router 配置的时候，添加下面这行代码配置日志中间件服务就可以了。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Router</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/foo&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">handler</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">nest_service</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/assets&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">serve_dir</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">clone</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">fallback_service</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">serve_dir</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">layer</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">TraceLayer</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new_for_http</span><span style="color:#ABB2BF;">());  </span><span style="color:#7F848E;font-style:italic;">// 添加这行</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>使用时，需要按照下面这个方式来使用。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">tracing</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">debug!</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;listening on {}&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">addr</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>我们用上面一句替代了之前的 <code>println!</code>，在一个正经一点的应用中，我们都不会使用 <code>println!</code> 去打印日志的。</p><p>这里需要补充一点知识：Rust 中的日志标准。Rust 标准的 log 协议在 <a href="https://docs.rs/log/latest/log/" target="_blank" rel="noreferrer">链接</a> 里。这个 crate 中定义了 5 个级别的日志打印语句。</p><ul><li><code>error!</code></li><li><code>warn!</code></li><li><code>info!</code></li><li><code>debug!</code></li><li><code>trace!</code></li></ul><p>这 5 个级别从上到下警示程度为由高到低。也就是说，越往下会越详细。</p><p>但是这只是一套协议的定义，而不是具体实现。具体使用的时候，需要用另外的 crate 来实现。我们常用的 env_logger 就是其中一种实现，它把日志输出到标准终端里，用环境变量来控制打印的级别开关。而这里我们使用的 tracing 库也是这样一种实现。它是为 tokio 异步运行时专门设计的，适合在异步并发代码中使用。</p><p>你可以使用 RUST_LOG 来打开日志开关。比如：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#D19A66;">RUST_LOG</span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;">trace</span><span style="color:#E06C75;"> cargo</span><span style="color:#E06C75;"> run</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>访问 <a href="http://127.0.0.1:3000/foo" target="_blank" rel="noreferrer">http://127.0.0.1:3000/foo</a> ，可以看到，TRACE 级别的和 DEBUG 级别的日志都打印出来了。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">36</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">39.</span><span style="color:#ABB2BF;">240674Z </span><span style="color:#D19A66;">TRACE</span><span style="color:#E5C07B;"> mio</span><span style="color:#ABB2BF;">::</span><span style="color:#E06C75;">poll</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">registering</span><span style="color:#E06C75;"> event</span><span style="color:#E06C75;"> source</span><span style="color:#E06C75;"> with</span><span style="color:#E06C75;"> poller</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">token</span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;">Token</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">), </span><span style="color:#E06C75;">interests</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">READABLE</span><span style="color:#56B6C2;"> |</span><span style="color:#D19A66;"> WRITABLE</span></span>
<span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">36</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">39.</span><span style="color:#ABB2BF;">240718Z </span><span style="color:#D19A66;">DEBUG</span><span style="color:#E06C75;"> axumapp03</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">listening</span><span style="color:#E06C75;"> on</span><span style="color:#D19A66;"> 127.0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">3000</span></span>
<span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">36</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">50.</span><span style="color:#ABB2BF;">029388Z </span><span style="color:#D19A66;">TRACE</span><span style="color:#E5C07B;"> mio</span><span style="color:#ABB2BF;">::</span><span style="color:#E06C75;">poll</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">registering</span><span style="color:#E06C75;"> event</span><span style="color:#E06C75;"> source</span><span style="color:#E06C75;"> with</span><span style="color:#E06C75;"> poller</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">token</span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;">Token</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">), </span><span style="color:#E06C75;">interests</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">READABLE</span><span style="color:#56B6C2;"> |</span><span style="color:#D19A66;"> WRITABLE</span></span>
<span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">36</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">50.</span><span style="color:#ABB2BF;">029678Z </span><span style="color:#D19A66;">TRACE</span><span style="color:#E5C07B;"> mio</span><span style="color:#ABB2BF;">::</span><span style="color:#E06C75;">poll</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">registering</span><span style="color:#E06C75;"> event</span><span style="color:#E06C75;"> source</span><span style="color:#E06C75;"> with</span><span style="color:#E06C75;"> poller</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">token</span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;">Token</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">), </span><span style="color:#E06C75;">interests</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">READABLE</span><span style="color:#56B6C2;"> |</span><span style="color:#D19A66;"> WRITABLE</span></span>
<span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">36</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">50.</span><span style="color:#ABB2BF;">030011Z </span><span style="color:#D19A66;">DEBUG</span><span style="color:#E06C75;"> request</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">method</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">GET</span><span style="color:#E06C75;"> uri</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">foo</span><span style="color:#E06C75;"> version</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">HTTP</span><span style="color:#ABB2BF;">/</span><span style="color:#D19A66;">1.1</span><span style="color:#ABB2BF;">}: </span><span style="color:#E5C07B;">tower_http</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">trace</span><span style="color:#ABB2BF;">::</span><span style="color:#E06C75;">on_request</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">started</span><span style="color:#E06C75;"> processing</span><span style="color:#E06C75;"> request</span></span>
<span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">36</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">50.</span><span style="color:#ABB2BF;">030127Z </span><span style="color:#D19A66;">DEBUG</span><span style="color:#E06C75;"> request</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">method</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">GET</span><span style="color:#E06C75;"> uri</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">foo</span><span style="color:#E06C75;"> version</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">HTTP</span><span style="color:#ABB2BF;">/</span><span style="color:#D19A66;">1.1</span><span style="color:#ABB2BF;">}: </span><span style="color:#E5C07B;">tower_http</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">trace</span><span style="color:#ABB2BF;">::</span><span style="color:#E06C75;">on_response</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">finished</span><span style="color:#E06C75;"> processing</span><span style="color:#E06C75;"> request</span></span>
<span class="line"><span style="color:#E06C75;"> latency</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#E06C75;"> ms</span><span style="color:#E06C75;"> status</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">200</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>用 debug 模式日志会少一些。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#D19A66;">RUST_LOG</span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;">debug</span><span style="color:#E06C75;"> cargo</span><span style="color:#E06C75;"> run</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>访问 <a href="http://127.0.0.1:3000/foo" target="_blank" rel="noreferrer">http://127.0.0.1:3000/foo</a> ， 输出：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">43</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">45.</span><span style="color:#ABB2BF;">223551Z </span><span style="color:#D19A66;">DEBUG</span><span style="color:#E06C75;"> axumapp03</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">listening</span><span style="color:#E06C75;"> on</span><span style="color:#D19A66;"> 127.0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">3000</span></span>
<span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">43</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">50.</span><span style="color:#ABB2BF;">558174Z </span><span style="color:#D19A66;">DEBUG</span><span style="color:#E06C75;"> request</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">method</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">GET</span><span style="color:#E06C75;"> uri</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">foo</span><span style="color:#E06C75;"> version</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">HTTP</span><span style="color:#ABB2BF;">/</span><span style="color:#D19A66;">1.1</span><span style="color:#ABB2BF;">}: </span><span style="color:#E5C07B;">tower_http</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">trace</span><span style="color:#ABB2BF;">::</span><span style="color:#E06C75;">on_request</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">started</span><span style="color:#E06C75;"> processing</span><span style="color:#E06C75;"> request</span></span>
<span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">43</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">50.</span><span style="color:#ABB2BF;">558303Z </span><span style="color:#D19A66;">DEBUG</span><span style="color:#E06C75;"> request</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">method</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">GET</span><span style="color:#E06C75;"> uri</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">foo</span><span style="color:#E06C75;"> version</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">HTTP</span><span style="color:#ABB2BF;">/</span><span style="color:#D19A66;">1.1</span><span style="color:#ABB2BF;">}: </span><span style="color:#E5C07B;">tower_http</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">trace</span><span style="color:#ABB2BF;">::</span><span style="color:#E06C75;">on_response</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">finished</span><span style="color:#E06C75;"> processing</span><span style="color:#E06C75;"> request</span></span>
<span class="line"><span style="color:#E06C75;"> latency</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#E06C75;"> ms</span><span style="color:#E06C75;"> status</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">200</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们还可以指定只打印某些 crate 里的日志。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#D19A66;">RUST_LOG</span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;">tower_http</span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;">debug</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">axumapp03</span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;">debug</span><span style="color:#E06C75;"> cargo</span><span style="color:#E06C75;"> run</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>访问 <a href="http://127.0.0.1:3000/foo" target="_blank" rel="noreferrer">http://127.0.0.1:3000/foo</a> ，输出：</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">45</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">03.</span><span style="color:#ABB2BF;">578294Z </span><span style="color:#D19A66;">DEBUG</span><span style="color:#E06C75;"> axumapp03</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">listening</span><span style="color:#E06C75;"> on</span><span style="color:#D19A66;"> 127.0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">3000</span></span>
<span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">45</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">08.</span><span style="color:#ABB2BF;">036568Z </span><span style="color:#D19A66;">DEBUG</span><span style="color:#E06C75;"> request</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">method</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">GET</span><span style="color:#E06C75;"> uri</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">foo</span><span style="color:#E06C75;"> version</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">HTTP</span><span style="color:#ABB2BF;">/</span><span style="color:#D19A66;">1.1</span><span style="color:#ABB2BF;">}: </span><span style="color:#E5C07B;">tower_http</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">trace</span><span style="color:#ABB2BF;">::</span><span style="color:#E06C75;">on_request</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">started</span><span style="color:#E06C75;"> processing</span><span style="color:#E06C75;"> request</span></span>
<span class="line"><span style="color:#D19A66;">2023</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">-11T05:</span><span style="color:#D19A66;">45</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">08.</span><span style="color:#ABB2BF;">036696Z </span><span style="color:#D19A66;">DEBUG</span><span style="color:#E06C75;"> request</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">method</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">GET</span><span style="color:#E06C75;"> uri</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">foo</span><span style="color:#E06C75;"> version</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">HTTP</span><span style="color:#ABB2BF;">/</span><span style="color:#D19A66;">1.1</span><span style="color:#ABB2BF;">}: </span><span style="color:#E5C07B;">tower_http</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">trace</span><span style="color:#ABB2BF;">::</span><span style="color:#E06C75;">on_response</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">finished</span><span style="color:#E06C75;"> processing</span><span style="color:#E06C75;"> request</span></span>
<span class="line"><span style="color:#E06C75;"> latency</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#E06C75;"> ms</span><span style="color:#E06C75;"> status</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">200</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>你可以下载 <a href="https://github.com/miketang84/jikeshijian/tree/master/2122-axumapp_stepbystep/axumapp03_addlog" target="_blank" rel="noreferrer">源码</a> 自行测试查看效果。</p><h3 id="第四步-解析-get-请求参数" tabindex="-1">第四步：解析 Get 请求参数 <a class="header-anchor" href="#第四步-解析-get-请求参数" aria-label="Permalink to &quot;第四步：解析 Get 请求参数&quot;">​</a></h3><p>一般一个 URL 是这样的：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>https://rustcc.cn/article?id=8ba98036-e2fb-41cf-9dad-7cd874c397c4</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>最后面一段是 query，query 的格式为键值对列表，比如 <code>x1=yyy&amp;x2=zzz</code> ，键值对之间使用 &amp; 符号隔开。</p><p>Axum 采用一种解包器（extractor）的方式，直接从 HTTP Request 里提取出开发者关心的参数信息。这种设计有一些好处：</p><ol><li>减少样板重复代码，可以让代码更紧凑易读。</li><li>类型化，充分利用 Rust 强大的类型能力。</li><li>配置式开发，轻松惬意。</li></ol><p>下面我们先来看如何从 GET 请求的 URL 中，取出 Query 参数。</p><p>在 Axum 中，我们只需要在 Handler 中这样配置解包器就可以。</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#[derive(</span><span style="color:#E5C07B;">Debug</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Deserialize</span><span style="color:#ABB2BF;">)]</span></span>
<span class="line"><span style="color:#C678DD;">struct</span><span style="color:#E5C07B;"> InputParams</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">    foo</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">i32</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    bar</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    third</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Option</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">i32</span><span style="color:#ABB2BF;">&gt;,</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> fn</span><span style="color:#61AFEF;"> query</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Query</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">params</span><span style="color:#ABB2BF;">): </span><span style="color:#E5C07B;">Query</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">InputParams</span><span style="color:#ABB2BF;">&gt;) -&gt; </span><span style="color:#C678DD;">impl</span><span style="color:#E5C07B;"> IntoResponse</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">    tracing</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">debug!</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;query params {:?}&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">params</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">    Html</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;&lt;h3&gt;Test query&lt;/h3&gt;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这里这个 params 参数就是我们想要的 query 请求参数。可以看到，Axum 框架自动帮我们处理了解析工作，让我们直接得到了 Rust 结构体对象。减轻了我们处理具体协议的繁琐度，不易出错。请注意示例第 8 行的参数中使用了模式匹配，你可以回顾一下 <a href="https://time.geekbang.org/column/article/720999" target="_blank" rel="noreferrer">第 6 讲</a> 的模式匹配相关知识点。</p><p>我们可以继续折腾一下，InputParams 里定义了一个 third 字段，它是 <code>Option&lt;i32&gt;</code> 类型，请你尝试在浏览器 URL 地址栏或插件中变换请求参数，查看及日志输出返回情况。可能的参数组合有下面这几种。</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>http://127.0.0.1:3000/query?foo=1&amp;bar=2&amp;third=3</span></span>
<span class="line"><span>http://127.0.0.1:3000/query?foo=1&amp;bar=2</span></span>
<span class="line"><span>http://127.0.0.1:3000/query?foo=1</span></span>
<span class="line"><span>http://127.0.0.1:3000/query?bar=2</span></span>
<span class="line"><span>http://127.0.0.1:3000/query?foo=1&amp;bar=2&amp;third=3&amp;another=4</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>本示例完整代码在 <a href="https://github.com/miketang84/jikeshijian/tree/master/2122-axumapp_stepbystep/axumapp04_query" target="_blank" rel="noreferrer">这里</a>。</p><h2 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h2><p>通过这节课的展示，你有没有体会到使用 Rust 进行 Web 开发的感觉？其实跟那些动态语言如 Python、JavaScript 等开发 Web 没太大区别，Axum 的代码也是比较精练的。请你一定要参考我给出的代码示例，对照源代码在你的本地跑起来。Web 开发一个非常方便的地方就是方便测试，易于看到渐进的效果正反馈，所以动手是非常重要而且高效的。</p><p>相比于动态语言来讲，Rust 的强类型更加能够保证 Web 后端服务的正确性和可靠性。性能自不用说，你选择了 Rust，就是选择了高起点。</p><p>同时你可以看到，这节课出现的 Axum 示例代码，一点都不复杂，甚至都没有用到 Rust 的所谓各种高级特性。其实就是这样，你用 Rust 做日常开发，特别是业务开发，根本不难，不要被那些所谓的高级特性吓到，先用现成的框架，快速捣鼓出自己的东西，后面再慢慢上难度就好了。</p><h2 id="思考题" tabindex="-1">思考题 <a class="header-anchor" href="#思考题" aria-label="Permalink to &quot;思考题&quot;">​</a></h2><p>请你说一说 Request/Response 模型是什么，Axum 框架和其他 gRPC 框架（比如 Tonic）有什么区别。欢迎你把自己的思考分享到评论区，也欢迎你把这节课的内容分享给其他朋友，我们下节课再见！</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/muyaCode/FrontEndLearnNotes/edit/main/docs/Document/21｜Web开发（上）：如何使用Axum框架进行Web后端开发？.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> 在 GitHub 上编辑此页<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>上次更新：: <time datetime="2025-02-28T18:19:24.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/tanggang_rust/Document/%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BD%9C%E7%AC%AC%E4%BA%8C%E7%AB%A0Rust%E8%BF%9B%E9%98%B6%E7%AF%87%E6%80%9D%E8%80%83%E9%A2%98%E7%AD%94%E6%A1%88" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>上一篇</span><span class="title" data-v-e257564d>答疑课堂（二）｜第二章Rust进阶篇思考题答案</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/tanggang_rust/Document/22%EF%BD%9CWeb%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AATodoList%E5%BA%94%E7%94%A8%EF%BC%9F" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>下一篇</span><span class="title" data-v-e257564d>22｜Web开发（下）：如何实现一个TodoList应用？</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Released under the MIT License.</p><p class="copyright" data-v-e315a0ad>Copyright © 2025  MuYa</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"document_00｜开篇词｜拥抱rust浪潮，迎接更极致的编程体验.md\":\"Bx6ruBRE\",\"document_01｜快速入门：rust中有哪些你不得不了解的基础语法？.md\":\"YEQ1UjRq\",\"document_02｜所有权（上）：rust是如何管理程序中的资源的？.md\":\"Bvb116GB\",\"document_03｜所有权（下）：rust中借用与引用的规则是怎样的？.md\":\"BJwhWwWd\",\"document_04｜字符串：对号入座，字符串其实没那么可怕！.md\":\"Bv5l_4z9\",\"document_05｜复合类型（上）：结构体与面向对象特性.md\":\"CITkKTJg\",\"document_06｜复合类型（下）：枚举与模式匹配.md\":\"Ct8Xedp7\",\"document_07｜类型与类型参数：给rust小助手提供更多信息.md\":\"EbjW2AkC\",\"document_08｜option-t-与result-t_e-、迭代器.md\":\"BNKn_0uw\",\"document_09｜初识trait：协议约束与能力配置.md\":\"llurKKcW\",\"document_10｜再探trait：带类型参数的trait及traitobject.md\":\"CMwHA5A-\",\"document_11｜常见trait解析：标准库中的常见trait应该怎么用？.md\":\"BGa5CpQf\",\"document_12｜智能指针：从所有权看智能指针.md\":\"Cxvwfxu6\",\"document_13｜独立王国：初步了解rust异步并发编程.md\":\"DSU5sdFT\",\"document_14｜tokio实战：编写一个网络命令行程序.md\":\"C1JeQOSl\",\"document_15｜tokio编程：在多任务之间操作同一片数据.md\":\"Bwzc0tpF\",\"document_16｜tokio编程：使用channel在不同任务间通信？.md\":\"DKrhaVoh\",\"document_17｜tokio编程：rust异步编程还有哪些需要注意的点？.md\":\"CmxLkup0\",\"document_18｜错误处理系统：错误的构建、传递和处理.md\":\"BWw-vDDL\",\"document_19｜rust的宏体系：为自己的项目写一个简单的声明宏.md\":\"DXluFKAD\",\"document_20｜生命周期：rust如何做基本的生命周期符号标注？.md\":\"Bt1xgIs6\",\"document_21｜web开发（上）：如何使用axum框架进行web后端开发？.md\":\"DXd_p46T\",\"document_22｜web开发（下）：如何实现一个todolist应用？.md\":\"Bi1r-Ulj\",\"document_23｜rust与大模型：用candle做一个聊天机器人.md\":\"CDaEmFi3\",\"document_24｜rust图像识别：利用yolov8识别对象.md\":\"CMFa5k75\",\"document_25｜rustgui编程：用slint为chatbot实现一个界面.md\":\"CSQiE64f\",\"document_26｜rustgui编程：用slint为yolov8实现一个界面.md\":\"8_AGledo\",\"document_27｜rustbevy游戏开发：用300行代码做一个贪吃蛇游戏.md\":\"DcZ-wJin\",\"document_28｜nom：用rust写一个parser解析器.md\":\"DtpKzSZI\",\"document_29｜unsafe编程（上）：unsaferust中那些被封印的能力.md\":\"DkGls-cm\",\"document_30｜unsafe编程（下）：使用rust为python写一个扩展.md\":\"tPXz85a6\",\"document_答疑课堂（一）｜第一章rust基础篇思考题答案.md\":\"CC_0mUbW\",\"document_答疑课堂（三）｜第三章rust应用篇思考题答案.md\":\"He3Na2GY\",\"document_答疑课堂（二）｜第二章rust进阶篇思考题答案.md\":\"rq96ZBKO\",\"document_结束语｜未来让rust带你“锈”到起飞.md\":\"CDoEtXUj\",\"document_结课测试｜来赴一场满分之约.md\":\"BDMdH3Zr\",\"index.md\":\"ZlsnMKnR\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh\",\"dir\":\"ltr\",\"title\":\"唐刚-Rust语言从入门到实战\",\"description\":\"Rust语言从入门到实战\",\"base\":\"/tanggang_rust/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/img/buding.svg\",\"siteTitle\":\"Rust语言从入门到实战\",\"outlineTitle\":\"⚡️文档内容大纲\",\"outline\":\"deep\",\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"displayDetails\":\"显示详细信息\",\"resetButtonTitle\":\"清除查询条件\",\"backButtonTitle\":\"返回搜索结果\",\"footer\":{\"selectText\":\"选择\",\"selectKeyAriaLabel\":\"enter\",\"navigateText\":\"切换\",\"navigateUpKeyAriaLabel\":\"up arrow\",\"navigateDownKeyAriaLabel\":\"down arrow\",\"closeText\":\"关闭\",\"closeKeyAriaLabel\":\"escape\"}}}}},\"miniSearch\":{\"options\":{},\"searchOptions\":{}}}},\"sidebar\":{\"/\":[{\"text\":\"00｜开篇词｜拥抱Rust浪潮，迎接更极致的编程体验\",\"link\":\"/Document/00｜开篇词｜拥抱Rust浪潮，迎接更极致的编程体验\"},{\"text\":\"01｜快速入门：Rust中有哪些你不得不了解的基础语法？\",\"link\":\"/Document/01｜快速入门：Rust中有哪些你不得不了解的基础语法？\"},{\"text\":\"02｜所有权（上）：Rust是如何管理程序中的资源的？\",\"link\":\"/Document/02｜所有权（上）：Rust是如何管理程序中的资源的？\"},{\"text\":\"03｜所有权（下）：Rust中借用与引用的规则是怎样的？\",\"link\":\"/Document/03｜所有权（下）：Rust中借用与引用的规则是怎样的？\"},{\"text\":\"04｜字符串：对号入座，字符串其实没那么可怕！\",\"link\":\"/Document/04｜字符串：对号入座，字符串其实没那么可怕！\"},{\"text\":\"05｜复合类型（上）：结构体与面向对象特性\",\"link\":\"/Document/05｜复合类型（上）：结构体与面向对象特性\"},{\"text\":\"06｜复合类型（下）：枚举与模式匹配\",\"link\":\"/Document/06｜复合类型（下）：枚举与模式匹配\"},{\"text\":\"07｜类型与类型参数：给Rust小助手提供更多信息\",\"link\":\"/Document/07｜类型与类型参数：给Rust小助手提供更多信息\"},{\"text\":\"08｜Option-T-与Result-T,E-、迭代器\",\"link\":\"/Document/08｜Option-T-与Result-T,E-、迭代器\"},{\"text\":\"09｜初识trait：协议约束与能力配置\",\"link\":\"/Document/09｜初识trait：协议约束与能力配置\"},{\"text\":\"10｜再探trait：带类型参数的trait及traitobject\",\"link\":\"/Document/10｜再探trait：带类型参数的trait及traitobject\"},{\"text\":\"11｜常见trait解析：标准库中的常见trait应该怎么用？\",\"link\":\"/Document/11｜常见trait解析：标准库中的常见trait应该怎么用？\"},{\"text\":\"答疑课堂（一）｜第一章Rust基础篇思考题答案\",\"link\":\"/Document/答疑课堂（一）｜第一章Rust基础篇思考题答案\"},{\"text\":\"12｜智能指针：从所有权看智能指针\",\"link\":\"/Document/12｜智能指针：从所有权看智能指针\"},{\"text\":\"13｜独立王国：初步了解Rust异步并发编程\",\"link\":\"/Document/13｜独立王国：初步了解Rust异步并发编程\"},{\"text\":\"14｜tokio实战：编写一个网络命令行程序\",\"link\":\"/Document/14｜tokio实战：编写一个网络命令行程序\"},{\"text\":\"15｜tokio编程：在多任务之间操作同一片数据\",\"link\":\"/Document/15｜tokio编程：在多任务之间操作同一片数据\"},{\"text\":\"16｜tokio编程：使用channel在不同任务间通信？\",\"link\":\"/Document/16｜tokio编程：使用channel在不同任务间通信？\"},{\"text\":\"17｜tokio编程：Rust异步编程还有哪些需要注意的点？\",\"link\":\"/Document/17｜tokio编程：Rust异步编程还有哪些需要注意的点？\"},{\"text\":\"18｜错误处理系统：错误的构建、传递和处理\",\"link\":\"/Document/18｜错误处理系统：错误的构建、传递和处理\"},{\"text\":\"19｜Rust的宏体系：为自己的项目写一个简单的声明宏\",\"link\":\"/Document/19｜Rust的宏体系：为自己的项目写一个简单的声明宏\"},{\"text\":\"20｜生命周期：Rust如何做基本的生命周期符号标注？\",\"link\":\"/Document/20｜生命周期：Rust如何做基本的生命周期符号标注？\"},{\"text\":\"答疑课堂（二）｜第二章Rust进阶篇思考题答案\",\"link\":\"/Document/答疑课堂（二）｜第二章Rust进阶篇思考题答案\"},{\"text\":\"21｜Web开发（上）：如何使用Axum框架进行Web后端开发？\",\"link\":\"/Document/21｜Web开发（上）：如何使用Axum框架进行Web后端开发？\"},{\"text\":\"22｜Web开发（下）：如何实现一个TodoList应用？\",\"link\":\"/Document/22｜Web开发（下）：如何实现一个TodoList应用？\"},{\"text\":\"23｜Rust与大模型：用Candle做一个聊天机器人\",\"link\":\"/Document/23｜Rust与大模型：用Candle做一个聊天机器人\"},{\"text\":\"24｜Rust图像识别：利用YOLOv8识别对象\",\"link\":\"/Document/24｜Rust图像识别：利用YOLOv8识别对象\"},{\"text\":\"25｜RustGUI编程：用Slint为Chatbot实现一个界面\",\"link\":\"/Document/25｜RustGUI编程：用Slint为Chatbot实现一个界面\"},{\"text\":\"26｜RustGUI编程：用Slint为YOLOv8实现一个界面\",\"link\":\"/Document/26｜RustGUI编程：用Slint为YOLOv8实现一个界面\"},{\"text\":\"27｜RustBevy游戏开发：用300行代码做一个贪吃蛇游戏\",\"link\":\"/Document/27｜RustBevy游戏开发：用300行代码做一个贪吃蛇游戏\"},{\"text\":\"28｜Nom：用Rust写一个Parser解析器\",\"link\":\"/Document/28｜Nom：用Rust写一个Parser解析器\"},{\"text\":\"29｜Unsafe编程（上）：UnsafeRust中那些被封印的能力\",\"link\":\"/Document/29｜Unsafe编程（上）：UnsafeRust中那些被封印的能力\"},{\"text\":\"30｜Unsafe编程（下）：使用Rust为Python写一个扩展\",\"link\":\"/Document/30｜Unsafe编程（下）：使用Rust为Python写一个扩展\"},{\"text\":\"答疑课堂（三）｜第三章Rust应用篇思考题答案\",\"link\":\"/Document/答疑课堂（三）｜第三章Rust应用篇思考题答案\"},{\"text\":\"结课测试｜来赴一场满分之约\",\"link\":\"/Document/结课测试｜来赴一场满分之约\"},{\"text\":\"结束语｜未来让Rust带你“锈”到起飞\",\"link\":\"/Document/结束语｜未来让Rust带你“锈”到起飞\"}]},\"editLink\":{\"pattern\":\"https://github.com/muyaCode/FrontEndLearnNotes/edit/main/docs/:path\",\"text\":\"在 GitHub 上编辑此页\"},\"lastUpdated\":{\"text\":\"上次更新：\",\"formatOptions\":{\"dateStyle\":\"full\",\"timeStyle\":\"medium\"}},\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2025  MuYa\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>